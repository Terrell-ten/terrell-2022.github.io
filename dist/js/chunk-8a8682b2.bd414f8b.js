(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8a8682b2"],{"0579":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingWeb,expression:"loadingWeb"}],staticClass:"main-conent main-conent-minheight flex-main-conent",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[a("div",{staticClass:"flex-box"},[a("div",{staticClass:"flex-top"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.formQuery}},[a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"日期从："}},[a("div",{staticClass:"block"},[a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",align:"right",placeholder:"开始日期","value-format":"yyyy-MM-dd","picker-options":{disabledDate:t.starDataMax}},model:{value:t.formQuery.startDate,callback:function(e){t.$set(t.formQuery,"startDate",e)},expression:"formQuery.startDate"}}),t._v(" - "),a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",align:"right",placeholder:"结束时间","value-format":"yyyy-MM-dd","picker-options":{disabledDate:t.endDataMin}},model:{value:t.formQuery.endDate,callback:function(e){t.$set(t.formQuery,"endDate",e)},expression:"formQuery.endDate"}})],1)]),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"状态："}},[a("el-select",{attrs:{placeholder:"状态"},on:{change:t.selectchange},model:{value:t.formQuery.nodetype,callback:function(e){t.$set(t.formQuery,"nodetype",e)},expression:"formQuery.nodetype"}},t._l(t.statusList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.namecode,value:t.id}})})),1)],1),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"工厂名称："}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:t.formQuery.factoryId,callback:function(e){t.$set(t.formQuery,"factoryId",e)},expression:"formQuery.factoryId"}},t._l(t.FactoryNameList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.factoryName,value:t.id}})})),1)],1),a("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}},[a("el-button",{attrs:{type:"primary",loading:t.loadingQuery},on:{click:t.onSubmit}},[t._v("查询")])],1),a("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}},[[100601,100612].indexOf(t.formQuery.nodetype)>=0&&t.buttonPermissions.indexOf(10064)>=0?a("el-button",{attrs:{type:"primary"},on:{click:t.clickApproval}},[t._v(t._s("初审通过"))]):[100602].indexOf(t.formQuery.nodetype)>=0&&t.buttonPermissions.indexOf(10065)>=0?a("el-button",{attrs:{type:"primary"},on:{click:t.clickApproval}},[t._v(t._s("复审通过"))]):t._e()],1),100600==t.formQuery.nodetype?a("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.goProductplan}},[t._v(t._s("计划生成"))])],1):t._e(),[100601,100602].indexOf(t.formQuery.nodetype)>=0?a("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}},[t.buttonPermissions.indexOf(10066)>=0?a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.rejectClick(0)}}},[t._v(t._s("驳回"))]):t._e()],1):t._e()],1)],1),a("div",{staticClass:"flex-cont"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTab,expression:"loadingTab"}],key:t.paramData.nodetype,ref:"TableData",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",stripe:"","tooltip-effect":"dark",height:"100%","highlight-current-row":""},on:{"selection-change":t.handleSelectionChange}},[t.searchCleOderBool?t._e():a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{property:"id",label:"标识",width:"50",align:"center"}}),a("el-table-column",{attrs:{property:"orderNo",label:"生产订单号",align:"center",width:"150"}}),a("el-table-column",{attrs:{property:"optName",label:"生成人",align:"center"}}),a("el-table-column",{attrs:{property:"optdate",label:"计划时间",align:"center",width:"95"}}),a("el-table-column",{attrs:{property:"factoryName",label:"工厂名称信息",align:"center"}}),a("el-table-column",{attrs:{property:"amount",label:"加工总金额（元）",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.amount))])]}}])}),a("el-table-column",{attrs:{property:"materialAmount",label:"材料总费用（元）",align:"center"}}),a("el-table-column",{attrs:{property:"auditUser",label:"初审人",align:"center"}}),a("el-table-column",{attrs:{property:"auditTime",label:"初审时间",align:"center",width:"95"}}),a("el-table-column",{attrs:{property:"doubleAuditUser",label:"复审人",align:"center"}}),a("el-table-column",{attrs:{property:"doubleAuditTime",label:"复审时间",align:"center"}}),a("el-table-column",{attrs:{property:"nodetypeName",label:"状态",align:"center"}}),a("el-table-column",{attrs:{property:"lastdate",label:"要求完成日期",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.lastdate?a("span",[t._v(" "+t._s(e.row.lastdate)+" "),["100600","100601","100612"].indexOf(e.row.nodetype)>=0?a("el-link",{staticClass:"el-icon-edit",attrs:{type:"primary"},on:{click:function(a){return t.clickDate(e.row,1)}}}):t._e()],1):["100600","100601","100612"].indexOf(e.row.nodetype)>=0?a("span",[a("el-link",{staticStyle:{cursor:"pointer",color:"dodgerblue"},on:{click:function(a){return t.clickDate(e.row,1)}}},[t._v("设置")])],1):t._e()]}}])}),a("el-table-column",{attrs:{property:"postil",label:"备注",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[["100607"].indexOf(e.row.nodetype)>=0?a("span",[t._v(t._s(e.row.cancelReason))]):a("div",[t._v(t._s(e.row.postil?e.row.postil:"(点击修改)"))])]),["100600","100611"].indexOf(e.row.nodetype)>=0?[e.row.postil?a("span",[t._v(" "+t._s(t._f("postil_substring")(e.row.postil))+" "),a("i",{staticClass:"el-icon-edit",staticStyle:{color:"dodgerblue","margin-left":"2px",cursor:"pointer"},on:{click:function(a){return t.clickDate(e.row,2)}}})]):a("el-link",{staticStyle:{cursor:"pointer",color:"dodgerblue"},on:{click:function(a){return t.clickDate(e.row,2)}}},[t._v("备注")])]:a("span",[["100607"].indexOf(e.row.nodetype)>=0?a("span",[t._v(t._s(t._f("postil_substring")(e.row.cancelReason)))]):a("span",[t._v(t._s(t._f("postil_substring")(e.row.postil)))])])],2)]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.clickDetail(e.row)}}},[t._v("查看明细")]),[100601,100602].indexOf(t.paramData.nodetype)>=0&&t.buttonPermissions.indexOf(10085)>=0?a("el-button",{attrs:{type:"danger"},on:{click:function(a){return t.cancelProduction(1,e.row.id)}}},[t._v(t._s("取 消"))]):t._e()]}}])})],1)],1),a("div",{staticClass:"flex-button"},[a("div",{staticClass:"margin-t16 text-right"},[a("AppPaging",{attrs:{total:t.allTate,pageSize:t.paramData.pageSize,currentPage:t.paramData.page,layout:"total,sizes,prev, pager, next"},on:{handleCurrentChange:t.clickCurrentChange,handleSizeChange:t.clickSizeChange}})],1)])]),a("el-dialog",{attrs:{title:t.stateName,visible:t.dialogVisibleDate,width:"30%"},on:{"update:visible":function(e){t.dialogVisibleDate=e}}},[1==t.statyNum?a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.latestDataTime,callback:function(e){t.latestDataTime=e},expression:"latestDataTime"}}):t._e(),2==t.statyNum?a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.stateInput,callback:function(e){t.stateInput=e},expression:"stateInput"}}):t._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisibleDate=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.clickDates()}}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"工厂名称信息",width:"80%",visible:t.dialogFactory},on:{"update:visible":function(e){t.dialogFactory=e}}},[a("el-dialog",{attrs:{width:"60%",title:"商品名称",visible:t.innerVisibleGoods,"append-to-body":""},on:{"update:visible":function(e){t.innerVisibleGoods=e}}})],1),a("el-dialog",{attrs:{title:"手工添加--生产计划单",width:"80%",visible:t.dialogManual},on:{"update:visible":function(e){t.dialogManual=e}}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0},model:{value:t.formManual,callback:function(e){t.formManual=e},expression:"formManual"}},[a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"计划人:"}},[a("span",[t._v(t._s(t.name))])]),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"审核人:"}},[a("span",[t._v(t._s(t.name))])]),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"订单状态:"}},[a("span",[t._v("订单状态")])]),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"计划日期: "}},[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.formManual.optdate,callback:function(e){t.$set(t.formManual,"optdate",e)},expression:"formManual.optdate"}})],1)]),a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"交货日期："}},[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.formManual.lastdate,callback:function(e){t.$set(t.formManual,"lastdate",e)},expression:"formManual.lastdate"}})],1)])],1),a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("添加工厂商品 "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:t.clickManualGoods}},[t._v("添加")])],1),a("el-table",{staticStyle:{width:"77%"},attrs:{stripe:"",height:"450",data:t.newDataManual,border:""}},[a("el-table-column",{attrs:{property:"id",label:"标识",align:"center"}}),a("el-table-column",{attrs:{property:"preLossRate",label:"预损耗率",align:"center"}}),a("el-table-column",{attrs:{property:"price",label:"采购或生产单价(元)",align:"center"}}),a("el-table-column",{attrs:{property:"productName",width:"250",label:"商品名称",align:"center"}}),a("el-table-column",{attrs:{property:"num",label:"数量",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})]}}])}),a("el-table-column",{attrs:{property:"miniNum",label:"起订量",align:"center"}}),a("el-table-column",{attrs:{property:"specification",label:"规格",align:"center"}}),a("el-table-column",{attrs:{property:"unit",label:"单位",align:"center"}}),a("el-table-column",{attrs:{property:"name",label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{cursor:"pointer"},attrs:{type:"danger"},on:{click:function(a){return t.delePurchase(e.row.id)}}},[t._v("删除")])]}}])})],1),a("el-dialog",{attrs:{width:"65%",title:"添加工厂生产商品",visible:t.dialogFormManual,"append-to-body":""},on:{"update:visible":function(e){t.dialogFormManual=e}}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"生产工厂名称:"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},on:{change:t.ChooseFactory},model:{value:t.manualId,callback:function(e){t.manualId=e},expression:"manualId"}},t._l(t.manualOptions,(function(t){return a("el-option",{key:t.id,attrs:{label:t.factoryName,value:t.id}})})),1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingWeb,expression:"loadingWeb"}],attrs:{data:t.dataManual,stripe:"",height:"450",border:""}},[a("el-table-column",{attrs:{property:"name",width:"100",label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{cursor:"pointer"},attrs:{type:"primary",disabled:e.row.states},on:{click:function(a){return t.clicPlanGoods(e.row)}}},[t._v("添加")])]}}])}),a("el-table-column",{attrs:{property:"id",label:"标识",width:"50",align:"center"}}),a("el-table-column",{attrs:{property:"price",width:"150",label:"采购或生产单价(元)",align:"center"}}),a("el-table-column",{attrs:{property:"productName",width:"450",label:"商品名称",align:"center"}}),a("el-table-column",{attrs:{property:"specification",label:"规格",width:"150",align:"center"}}),a("el-table-column",{attrs:{property:"miniNum",label:"起订量",align:"center"}}),a("el-table-column",{attrs:{property:"unit",label:"单位",width:"120",align:"center"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogManual=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.putPurchase}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"生产计划审批管理-查看明细",visible:t.outerVisible,width:"86%"},on:{"update:visible":function(e){t.outerVisible=e}}},[[a("div",{staticClass:" detail-top-flex"},[a("div",{staticClass:"detail-top-l"},[a("div",[t._v("生产订单号："+t._s(t.ProductionPlanDetailList.planCode))]),a("div",[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),a("div",[t._v("加工总金额："+t._s(t.ProductionPlanDetailList.amount)+"（元）")]),a("div",[t._v("材料总费用："+t._s(t.ProductionPlanDetailList.bomAmount)+"（元）")]),a("br"),a("div",[t._v("状态："+t._s(t.ProductionPlanDetailList.nodetypeName))]),a("div",[t._v("审核人："+t._s(t.ProductionPlanDetailList.auditUser))]),a("div",[t._v("审批时间："+t._s(null===t.doubleAuditTime?t.doubleAuditTimes:t.doubleAuditTime))]),a("div",[t._v("要求完成日期："+t._s(t.ProductionPlanDetailList.lastdate))]),a("br"),["100601","100612","100602"].indexOf(t.ProductionPlanDetailList.nodetype)<0?a("div",[t._v("备注："+t._s(t.ProductionPlanDetailList.vdata?t.ProductionPlanDetailList.vdata.postil:""))]):t._e()]),["100600","100601","100611","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0?a("div",{staticClass:"detail-top-r"},[t.buttonPermissions.indexOf(10077)>=0?[[100600,100611,100601,100602,100612].indexOf(Number(t.ProductionPlanDetailList.nodetype))>=0?a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.cancelProductionDetails(3)}}},[t._v("批量勾选取消")]):t._e()]:t._e()],2):t._e()])],a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingVisible,expression:"loadingVisible"}],staticStyle:{width:"100%"},attrs:{data:t.ProductionDetailsList,"max-height":"400px",stripe:"",border:""}},[a("el-table-column",{attrs:{property:"id",label:"标识",width:"50",align:"center"}}),a("el-table-column",{attrs:{property:"namecode",label:"产品名称",align:"center",width:"200","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{property:"specif",label:"规格",align:"center"}}),a("el-table-column",{attrs:{property:"skuCode",label:"SKU",align:"center",width:"200"}}),a("el-table-column",{attrs:{property:"unit",label:"生产单位",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{},[a("span",[t._v(t._s(e.row.unit))])])]}}])}),a("el-table-column",{attrs:{property:"num",label:"生产数量",align:"center",width:"80"}}),a("el-table-column",{attrs:{property:"stock",label:"当前库存数",align:"center",width:"100"}}),a("el-table-column",{attrs:{property:"minStock",label:"最低库存",align:"center",width:"80"}}),a("el-table-column",{attrs:{property:"price",label:"单价（元）",align:"center",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{},[a("span",[t._v(t._s(e.row.price))])])]}}])}),a("el-table-column",{attrs:{property:"amount",label:"金额（元）",align:"center",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.amount))])]}}])}),a("el-table-column",{attrs:{property:"miniNum",label:"起订量",align:"center",width:"80"}}),a("el-table-column",{attrs:{property:"nodetypeName",label:"状态",align:"center"}}),a("el-table-column",{attrs:{property:"script",label:"备注",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("div",[t._v(t._s(e.row.script?e.row.script:"(点击修改)"))])]),a("span",[t._v(t._s(t._f("postil_substring")(e.row.script)))])])]}}])}),a("el-table-column",{attrs:{property:"postil",label:"操作",align:"center","min-width":"240",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[["100601","100602","100611","100612","100600"].indexOf(e.row.nodetype)>=0?a("el-button",{attrs:{disabled:"0"==e.row.settype},nativeOn:{click:function(a){return t.purchaseClick(e.row)}}},[t._v("查看材料")]):a("el-button",{attrs:{disabled:"0"==e.row.settype},nativeOn:{click:function(a){return t.materialClick(e.row)}}},[t._v("查看材料")]),["100601","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0&&t.buttonPermissions.indexOf(10067)>=0?a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(a){return t.GoodsModifyOpen2(e.row)}}},[t._v("修改")]):t._e(),t.buttonPermissions.indexOf(10079)>=0?[["100600","100611","100601","100602","100612"].indexOf(e.row.nodetype)>=0?a("el-button",{attrs:{type:"danger"},on:{click:function(a){return t.cancelProductionDetails(1,e.row.id)}}},[t._v(t._s("取消"))]):t._e()]:t._e()]}}])})],1),a("div",{staticClass:"dialog-footer",staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"footer"},slot:"footer"},[a("div",[[100601,100602].indexOf(t.paramData.nodetype)>=0&&t.buttonPermissions.indexOf(10066)>=0?[a("span",{staticStyle:{color:"#999"}},[t._v("备注：")]),a("div",{staticStyle:{display:"inline-block","margin-right":"30px",width:"400px"}},[a("el-input",{attrs:{placeholder:"驳回原因"},model:{value:t.RejectPostil,callback:function(e){t.RejectPostil=e},expression:"RejectPostil"}})],1),a("el-button",{attrs:{size:"medium",type:"danger"},on:{click:function(e){return t.rejectClick2()}}},[t._v("驳回")])]:t._e()],2),a("div",[["100601","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0&&t.buttonPermissions.indexOf(10064)>=0?a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.detailAudit}},[t._v(" "+t._s("初审通过")+" ")]):["100602"].indexOf(t.ProductionPlanDetailList.nodetype)>=0&&t.buttonPermissions.indexOf(10065)>=0?a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.detailAudit}},[t._v(" "+t._s("复审通过")+" ")]):t._e(),t.buttonPermissions.indexOf(10078)>=0?[[100600,100611,100601,100602,100612].indexOf(t.formQuery.nodetype)>=0?a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.cancelProduction(1,t.idLists)}}},[t._v(t._s("取消生产计划单"))]):t._e()]:t._e(),a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.outerVisible=!1}}},[t._v("返 回")])],2)])],2),a("el-dialog",{attrs:{width:"30%",title:"生产计划审批管理备注修改",visible:t.innerVisibleOrder,"append-to-body":""},on:{"update:visible":function(e){t.innerVisibleOrder=e}}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.innerVisibleInput,callback:function(e){t.innerVisibleInput=e},expression:"innerVisibleInput"}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.innerVisibleOrder=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.clickPostils}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{visible:t.unitForm.dialogVisible,title:"修改生产单位",width:"20%","destroy-on-close":"",center:""},on:{"update:visible":function(e){return t.$set(t.unitForm,"dialogVisible",e)}},model:{value:t.unitForm.dialogVisible,callback:function(e){t.$set(t.unitForm,"dialogVisible",e)},expression:"unitForm.dialogVisible"}},[a("el-form",{ref:"unitForm",attrs:{rules:t.unitForm.rules,model:t.unitForm}},[a("el-form-item",{staticStyle:{width:"280px",margin:"auto","line-height":"1.6"}},[a("p",[t._v("当前单位："+t._s(t.unitForm.unit))]),t._v(" 修改至："),a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.unitSelect()}},model:{value:t.UnitsData.index,callback:function(e){t.$set(t.UnitsData,"index",e)},expression:"UnitsData.index"}},t._l(t.UnitsData.list,(function(t,e){return a("el-option",{key:e,attrs:{label:t.namecode,value:e}})})),1),a("p",[t._v("单位配比："+t._s(t.UnitsData.conversionRatio))])],1),a("el-form-item",{staticStyle:{"margin-top":"30px"}},[a("div",{staticStyle:{width:"100%","margin-left":"auto","margin-right":"auto","text-align":"center"}},[a("el-button",{on:{click:function(e){return t.resetUnit("unitForm")}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateUnit("unitForm")}}},[t._v("确定")])],1)])],1)],1),a("el-dialog",{attrs:{visible:t.PriceForm.dialogVisible,title:"修改单价",width:"20%","destroy-on-close":"",center:""},on:{"update:visible":function(e){return t.$set(t.PriceForm,"dialogVisible",e)}},model:{value:t.PriceForm.dialogVisible,callback:function(e){t.$set(t.PriceForm,"dialogVisible",e)},expression:"PriceForm.dialogVisible"}},[a("el-form",{ref:"PriceForm",attrs:{rules:t.PriceForm.rules,model:t.PriceForm}},[a("el-form-item",{staticStyle:{width:"280px",margin:"auto","line-height":"1.6"}},[a("el-input",{attrs:{min:"0",type:"number",placeholder:"单价"},model:{value:t.PriceForm.val,callback:function(e){t.$set(t.PriceForm,"val",e)},expression:"PriceForm.val"}})],1),a("el-form-item",{staticStyle:{"margin-top":"30px"}},[a("div",{staticStyle:{width:"100%","margin-left":"auto","margin-right":"auto","text-align":"center"}},[a("el-button",{on:{click:function(e){return t.resetPrice("PriceForm")}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updatePrice("PriceForm")}}},[t._v("确定")])],1)])],1)],1),a("el-dialog",{attrs:{title:"关联包材单",visible:t.dialogPackaging,width:"80%"},on:{"update:visible":function(e){t.dialogPackaging=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.PackagingList,stripe:"",border:""}},[a("el-table-column",{attrs:{prop:"id",label:"标识"}}),a("el-table-column",{attrs:{prop:"namecode",label:"材料名称"}}),a("el-table-column",{attrs:{prop:"specif",label:"规格"}}),a("el-table-column",{attrs:{prop:"num",label:"数量"}}),a("el-table-column",{attrs:{prop:"price",label:"单价(元)"}}),a("el-table-column",{attrs:{prop:"unit",label:"单位"}}),a("el-table-column",{attrs:{prop:"unitbit",label:"单位配比"}}),a("el-table-column",{attrs:{prop:"nodetype",label:"状态"}}),a("el-table-column",{attrs:{prop:"lastdate",label:"完成时间"}}),a("el-table-column",{attrs:{prop:"vdata",label:"其他属性"}}),a("el-table-column",{attrs:{prop:"optdate",label:"计划时间"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogPackaging=!1}}},[t._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"关联生产单",visible:t.dialogProduction,width:"80%"},on:{"update:visible":function(e){t.dialogProduction=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.ProductionList,stripe:"",border:""}},[a("el-table-column",{attrs:{property:"id",label:"标识"}}),a("el-table-column",{attrs:{prop:"namecode",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"specif",label:"规格"}}),a("el-table-column",{attrs:{prop:"num",label:"数量"}}),a("el-table-column",{attrs:{prop:"price",label:"生产单价(元)"}}),a("el-table-column",{attrs:{prop:"unit",label:"单位"}}),a("el-table-column",{attrs:{prop:"nodetype",label:"状态"}}),a("el-table-column",{attrs:{prop:"lastdate",label:"完成时间"}}),a("el-table-column",{attrs:{prop:"optdate",label:"计划时间"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogProduction=!1}}},[t._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"添加支付记录",visible:t.dialogPayAdd,width:"40%"},on:{"update:visible":function(e){t.dialogPayAdd=e},close:t.AddPayDialogClosed}},[a("div",{staticClass:"pay_add"},[a("div",[t._v("生产单ID："+t._s(t.AddRelaId))]),a("div",[t._v("工厂："+t._s(t.PayEditFactoryName))])]),a("el-form",{ref:"AddPayFormRef",staticClass:"demo-form-inline formInput",attrs:{inline:!0,model:t.formPayAdd,rules:t.AddPayFormRules}},[a("el-form-item",{attrs:{label:"收付款方账号信息：",prop:"namecode"}},[a("el-input",{attrs:{clearable:""},model:{value:t.formPayAdd.namecode,callback:function(e){t.$set(t.formPayAdd,"namecode",e)},expression:"formPayAdd.namecode"}})],1),a("el-form-item",{attrs:{label:"付款金额(元)：",prop:"amount"}},[a("el-input",{attrs:{clearable:""},model:{value:t.formPayAdd.amount,callback:function(e){t.$set(t.formPayAdd,"amount",e)},expression:"formPayAdd.amount"}})],1),a("el-form-item",{attrs:{label:"状态类型：",prop:"nodetype"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择类型"},model:{value:t.formPayAdd.nodetype,callback:function(e){t.$set(t.formPayAdd,"nodetype",e)},expression:"formPayAdd.nodetype"}},[a("el-option",{attrs:{label:"预付",value:"102101"}}),a("el-option",{attrs:{label:"续付",value:"102102"}}),a("el-option",{attrs:{label:"返还抵扣",value:"102103"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogPayAdd=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.PayAddClick}},[t._v("保 存")])],1)],1),a("el-dialog",{attrs:{title:"编辑支付记录",visible:t.dialogPayEdit,width:"40%"},on:{"update:visible":function(e){t.dialogPayEdit=e},close:t.editPayDialogClosed}},[a("div",{staticClass:"pay_add"},[a("div",[t._v("生产单ID："+t._s(t.AddRelaId))]),a("div",[t._v("工厂："+t._s(t.PayEditFactoryName))])]),a("el-form",{ref:"editPayFormRef",staticClass:"demo-form-inline formInput",attrs:{inline:!0,model:t.PayEditForm,rules:t.editPayFormRules}},[a("el-form-item",{attrs:{label:"收付款方账号信息：",prop:"namecode"}},[a("el-input",{model:{value:t.PayEditForm.namecode,callback:function(e){t.$set(t.PayEditForm,"namecode",e)},expression:"PayEditForm.namecode"}})],1),a("el-form-item",{attrs:{label:"付款金额(元)：",prop:"amount"}},[a("el-input",{model:{value:t.PayEditForm.amount,callback:function(e){t.$set(t.PayEditForm,"amount",e)},expression:"PayEditForm.amount"}})],1),a("el-form-item",{attrs:{label:"状态类型：",prop:"nodetype"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择类型"},model:{value:t.PayEditForm.nodetype,callback:function(e){t.$set(t.PayEditForm,"nodetype",e)},expression:"PayEditForm.nodetype"}},[a("el-option",{attrs:{label:"预付",value:"102101"}}),a("el-option",{attrs:{label:"续付",value:"102102"}}),a("el-option",{attrs:{label:"返还抵扣",value:"102103"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium "},on:{click:function(e){t.dialogPayEdit=!1}}},[t._v("取 消")]),a("el-button",{attrs:{size:"medium ",type:"primary"},on:{click:t.dialogPayEditSave}},[t._v("保 存")])],1)],1),a("el-dialog",{staticStyle:{"margin-top":"15vh"},attrs:{title:"导出提示",visible:t.dialogExport,width:"30%"},on:{"update:visible":function(e){t.dialogExport=e}}},[a("span",[t._v(t._s(t.ExportHints))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.dialogExportClick}},[t._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"材料明细",visible:t.dialogMaterial,width:"60%"},on:{"update:visible":function(e){t.dialogMaterial=e}}},[a("div",{staticClass:"detail_top1"},[a("div",[t._v("关联源生产单号："+t._s(t.ProductionPlanDetailList.planCode))]),a("div",[t._v("入库人姓名："+t._s(t.ProductionPlanDetailList.auditUser))]),a("div",[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),a("div",[t._v("类型："+t._s("102301"==t.materialSettype?"工厂采购":"102302"==t.materialSettype?"公司采购":"采购类型不存在"))])]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.MaterialDetailsList,stripe:"","max-height":"400px"}},[a("el-table-column",{attrs:{property:"data",label:"标识",width:"50",align:"center"}}),a("el-table-column",{attrs:{property:"namecode",label:"材料名称",align:"center"}}),a("el-table-column",{attrs:{property:"specif",label:"规格",align:"center"}}),a("el-table-column",{attrs:{property:"price",label:"单价(元)",align:"center"}}),a("el-table-column",{attrs:{property:"unit",label:"单位",align:"center"}}),a("el-table-column",{attrs:{property:"num",label:"生产数量",align:"center"}}),a("el-table-column",{attrs:{property:"outcount",label:"出库数量",align:"center"}}),a("el-table-column",{attrs:{property:"specif",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{directives:[{name:"show",rawName:"v-show",value:102801===e.row.nodeType,expression:"scope.row.nodeType===102801"}]},[t._v("待处理")]),a("span",{directives:[{name:"show",rawName:"v-show",value:102802===e.row.nodeType,expression:"scope.row.nodeType===102802"}]},[t._v("已处理")]),a("span",{directives:[{name:"show",rawName:"v-show",value:102803===e.row.nodeType,expression:"scope.row.nodeType===102803"}]},[t._v("已出库")]),a("span",{directives:[{name:"show",rawName:"v-show",value:102804===e.row.nodeType,expression:"scope.row.nodeType===102804"}]},[t._v("已确认")])]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){t.dialogMaterial=!1}}},[t._v("返 回")])],1)],1),a("el-dialog",{attrs:{title:"采购查看",visible:t.purchaseDialog.sync,width:"1000px"},on:{"update:visible":function(e){return t.$set(t.purchaseDialog,"sync",e)}}},[a("div",{staticClass:"detail_top1 detail_top2"},[a("div",{staticStyle:{width:"100%"}},[t._v("关联源生产单号："+t._s(t.ProductionPlanDetailList.planCode))]),a("div",{staticStyle:{width:"45%"}},[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),a("div",{staticStyle:{width:"45%"}},[t._v("采购类型："+t._s(t.purchaseDialog.row.typeName))])]),a("el-table",{key:t.purchaseDialog.row.settype,staticStyle:{width:"100%"},attrs:{data:t.purchaseDialog.Data,stripe:"","max-height":"400px"}},[a("el-table-column",{attrs:{property:"index",label:"序号",width:"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.$index+1)+" ")]}}])}),a("el-table-column",{attrs:{property:"namecode",label:"材料名称",align:"center"}}),a("el-table-column",{attrs:{property:"specification",label:"规格",align:"center"}}),a("el-table-column",{attrs:{property:"unit",label:"单位",align:"center"}}),[102302].indexOf(Number(t.purchaseDialog.row.settype))<0?a("el-table-column",{attrs:{property:"price",label:"参考单价",align:"center"}}):t._e(),a("el-table-column",{attrs:{property:"num",label:"数量",align:"center"}}),[102302].indexOf(Number(t.purchaseDialog.row.settype))<0?a("el-table-column",{attrs:{property:"amount",label:"参考金额",align:"center"}}):t._e(),a("el-table-column",{attrs:{property:"hxInventory",label:"华项仓库库存",align:"center"}}),a("el-table-column",{attrs:{property:"inventory",label:"工厂仓库库存",align:"center"}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.purchaseDialog.sync=!1}}},[t._v("关 闭")])],1)],1),a("el-dialog",{attrs:{width:"25%",title:"驳回",visible:t.rejectData.sync,"append-to-body":""},on:{"update:visible":function(e){return t.$set(t.rejectData,"sync",e)}}},[a("span",[t._v("你确定要对已选的数据进行驳回吗？")]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.rejectData.sync=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.rejectClick(1)}}},[t._v("确 定")])],1)]),a("MakeGoodsModify",{ref:"MakeGoodsModify",on:{ToUpDate:t.Detail_ToUpData}})],1)},n=[],o=a("1da1"),l=a("5530"),r=(a("96cf"),a("d3b7"),a("159b"),a("b0c0"),a("25f0"),a("d81d"),a("2f62")),s=a("ef7e"),c=a("7c58"),d=a("062d"),u=a("4795"),p=a("49e5"),m=a("2f88"),f={components:{MakeGoodsModify:p["a"],AppPaging:m["a"]},data:function(){return{scrollTop:0,scrollLeft:0,standard:{num:0,price:0},rejectVal:"",innerVisibleRow:{},table_id_arr_detail:[],table_plan_arr_detail:[],table_id_arr:[],table_plan_arr:[],rejectData:{param:{},sync:!1,val:""},clickUnit_type:0,istruenew:!0,loadingVisible:!1,loadingWeb:!0,loadingTab:!1,loadingQuery:!1,info:{isTrue:!1,isShow:!0},checked:!1,checked1:!1,checked2:!1,checked3:!1,value1:"",value2:"",allTate:0,currentPage:1,paramData:{page:1,pageSize:24},tableData:[],dialogVisibleDate:!1,latestDataTimeId:"",stateInput:"",statyNum:"",stateName:"",innerVisibleGoods:!1,latestDataTime:"",dialogFactory:!1,gridData:[],formQuery:{nodetype:100600,timeData:"",factoryId:"",productName:""},innerVisibleOrder:!1,innerVisibleId:"",innerVisibleInput:"",statusList:[],dialogManual:!1,formManual:{},manualId:"",manualOptions:"",dataManual:[],newDataManual:[],idList:[],dialogFormManual:!1,searchCleOderBool:!1,dialogCustomerOrder:!1,CustomerOrderList:[],dialogPackaging:!1,PackagingList:[],dialogProduction:!1,ProductionList:[],dialogMaterial:!1,MaterialDetailsList:[],materialSettype:"",dialogExport:!1,ExportHints:"",ProductionDetailsList:[],ProductionPlanDetailList:[],idLists:[],dialogPaymentRecords:!1,PaymentRecordsList:[],formQueryInfo:{factoryId:"",timeData:""},FactoryNameList:[],AddPayFormRules:{namecode:[{required:!0,message:"请输入收付款方账号信息",trigger:"blur"}],amount:[{required:!0,message:"请输入付款金额",trigger:"blur"}],nodetype:[{required:!0,message:"请选择类型",trigger:"blur"}]},dialogPayAdd:!1,AddRelaId:"",manufacturerId:"",formPayAdd:{namecode:"",amount:"",nodetype:""},outerVisible:!1,dialogPayEdit:!1,PayEditForm:{},PayEditFactoryName:"",editPayFormRules:{namecode:[{required:!0,message:"请输入收付款方账号信息",trigger:"blur"}],amount:[{required:!0,message:"请输入付款金额",trigger:"blur"}],nodetype:[{required:!0,message:"请选择类型",trigger:"blur"}]},unitForm:{dialogVisible:!1,id:"",unit:"",rules:{script:[{required:!0,message:"请输入单位",trigger:"blur"}]},optdate:""},parameterDetail:{},EditPayId:"",approvalList:[],Plannedtime:"",doubleAuditTime:"",doubleAuditTimes:"",UnitsData:{list:[],editUnit:"",index:0,id:0,conversionRatio:"",parame:{detailId:0,unit:"",unitBit:0}},PriceForm:{dialogVisible:!1,row:{},id:"",val:"",max_val:"",rules:{script:[{required:!0,message:"请输入单价",trigger:"blur"}]},optdate:""},buttonPermissions:[],RejectId:"",RejectPostil:"",purchaseDialog:{sync:!1,row:{},Data:[]}}},computed:Object(l["a"])({},Object(r["c"])({roles:"roles",userId:"user/userId",name:"user/name"})),created:function(){this.buttonPermissions=this.roles[0].buttonPermissions,this.formQuery.nodetype=100601,this.onSubmit(),this.getformQueryStatusList(),this.getFactoryList(),this.getFactoryName()},methods:{Detail_ToUpData:function(){this.getProductionPlanDetailList(this.parameterDetail)},GoodsModifyOpen2:function(t){this.$refs.MakeGoodsModify.init(t,this.ProductionPlanDetailList)},kafizhon:function(){this.$confirm("功能开发中...","提示",{confirmButtonText:"确定"}).then((function(){}))},detailsSelectionChange:function(t){var e=this;this.table_id_arr_detail=[],this.table_plan_arr_detail=[],t.length>0&&(this.table_plan_arr_detail=t,t.forEach((function(t){e.table_id_arr_detail.push(t.id)})))},cancelProductionDetails:function(t,e){var a=this,i={operator:this.name,planId:this.idLists,remarks:""},n="你确定要取消选中的商品吗？";if(1===t&&(i.planDetailIds=[e]),3===t){if(this.table_id_arr_detail.length<=0)return void this.$message.warning("请您选择要操作的数据！");n="你确定要取消当前选中的"+this.table_id_arr_detail.length+"个商品吗？",i.planDetailIds=this.table_id_arr_detail}this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showInput:!0,inputPlaceholder:"请输入取消原因"}).then((function(t){i.remarks=t.value,Object(s["d"])(i).then((function(t){200===t.code&&(a.$message.success(t.message),i.planDetailIds.length>=a.ProductionDetailsList.length&&(a.outerVisible=!1),a.getProductionPlanDetailList(a.parameterDetail),a.setTable(a.paramData))}))})).catch((function(){}))},cancelProduction:function(t,e){var a=this,i={operator:this.name,remarks:""},n="你确定要取消当前的生产计划单吗？";if(1===t&&(i.planId=e),3===t){if(this.table_id_arr.length<=0)return void this.$message.warning("请您选择要操作的数据！");n="你确定要取消当前选中的"+this.table_id_arr.length+"条生产计划单吗？",i.planId=this.table_id_arr}this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showInput:!0,inputPlaceholder:"请输入取消原因"}).then((function(t){i.remarks=t.value,Object(s["c"])(i).then((function(t){200===t.code&&(a.$message.success(t.message),a.outerVisible=!1,a.setTable(a.paramData))}))})).catch((function(){}))},starDataMax:function(t){if(this.formQuery.endDate)return t.getTime()>=Date.parse(this.formQuery.endDate)},endDataMin:function(t){if(this.formQuery.startDate)return t.getTime()<=Date.parse(this.formQuery.startDate)-864e5},rejectClick:function(t){var e=this;if(0===t||2===t){if(!this.table_id_arr.length)return void this.$message({type:"warning",message:"请您选择要操作的数据！"});0===t&&(this.RejectId=""),this.rejectData.sync=!0,this.rejectData.val="",this.rejectData.param={I_optType:11,I_ids:this.table_id_arr.toString(),I_rovaluser:this.name},100601===this.formQuery.nodetype?this.rejectData.param.I_optType=11:100602===this.formQuery.nodetype?this.rejectData.param.I_optType=12:this.$message.warning("相关状态功能还在开发中！")}if(1===t)if(this.RejectId){var a=this.rejectData.param.I_optType;a=11===a?"100611":"100612";var i={nodetype:a,postil:this.RejectPostil};Object(s["a"])(i,this.RejectId).then((function(t){e.loadingWeb=!1,200===t.code?(e.$message.success("驳回成功!"),e.paramData.page=1,e.setTable(e.paramData),e.outerVisible=!1,e.rejectData.sync=!1):e.$message.warning(t.message)}))}else Object(s["o"])(this.rejectData.param).then((function(t){e.loadingWeb=!1,200===t.code?(e.$message.success("驳回成功!"),e.paramData.page=1,e.setTable(e.paramData),e.outerVisible=!1,e.rejectData.sync=!1):e.$message.warning(t.message)}))},rejectClick2:function(){this.RejectId=this.idLists,this.table_id_arr=[],this.table_id_arr.push(this.idLists),this.rejectClick(2)},get_num_amount:function(){this.standard.num=this.count_price2(this.GoodsModifyDemo.data.num_modify,this.GoodsModifyDemo.data.unitbit),this.set_amount_modify()},get_num_price:function(t){this.standard.price=this.count_price(this.GoodsModifyDemo.data.price_modify,this.GoodsModifyDemo.data.unitbit),1!==t&&this.set_amount_modify()},set_amount_modify:function(){var t=this.GoodsModifyDemo.data.num_modify,e=this.GoodsModifyDemo.data.price_modify,a=Math.ceil(1e4*t*e)/1e4;this.GoodsModifyDemo.data.amount_modify=a},get_amount_modify:function(){var t=this.GoodsModifyDemo.data.amount_modify,e=this.GoodsModifyDemo.data.num_modify,a=Math.ceil(1e4*t/e)/1e4;this.GoodsModifyDemo.data.price_modify=a,this.get_num_price(1)},detailsUpdateUnit:function(){this.GoodsModifyDemo.data.unit_modify=this.UnitsData.parame.unit;var t=this.count_price2(this.standard.price,this.UnitsData.parame.unitBit);this.GoodsModifyDemo.data.price_modify=t;var e=this.count_price(this.standard.num,this.UnitsData.parame.unitBit);this.GoodsModifyDemo.data.num_modify=e,this.GoodsModifyDemo.data.unitbit_d=this.UnitsData.parame.unitBit,this.resetUnit()},getformQueryStatusList:function(){this.statusList=[{id:100601,namecode:"正在初审"},{id:100612,namecode:"复审驳回"},{id:100602,namecode:"正在复审"},{id:100605,namecode:"入库中"},{id:100606,namecode:"完成入库"},{id:100607,namecode:"已作废"},{id:100608,namecode:"完成支付"}]},getProductionPlanStatus:function(){var t=this;Object(s["s"])({}).then((function(e){t.statusList=e.data}))},goProductplan:function(){this.$router.push({path:"/operationmanagement/Procurementplan/productplan",query:{path:!0}})},selectchange:function(t){this.onSubmit()},purchaseClick:function(t){var e=this;this.purchaseDialog.row=t,this.purchaseDialog.sync=!0,this.purchaseDialog.Data=[];var a={planDetailId:t.id};Object(s["m"])(a).then((function(t){200===t.code&&(e.purchaseDialog.Data=t.data)}))},count_price:function(t,e){return t<=0||0===e?0:1===e?t:e>0?Math.ceil(t/e*1e4)/1e4:Math.ceil(t*e*1e4)/1e4*-1},count_price2:function(t,e){return t<=0||0===e?0:1===e?t:e>0?Math.ceil(t*e*1e4)/1e4:Math.ceil(t/e*1e4)/1e4*-1},clickUnit:function(t,e){this.clickUnit_type=e||0,this.unitForm.unit=t.unit;var a={productId:t.productId,unit:t.unit};3===e&&(a.unit=t.unit_modify),this.UnitsData.id=t.id,this.UnitsData.index=0,this.getUnitsToPlan(a)},getUnitsToPlan:function(t){var e=this;this.UnitsData.parame.detailId=this.UnitsData.id,Object(c["R"])(t).then((function(t){200===t.code?e.unit_dialog_init(t.data):e.$message({message:t.message,type:"warning"})}))},unit_dialog_init:function(t){if(t.length>0){this.UnitsData.list=t;var e=t[0];this.UnitsData.conversionRatio=e.conversionRatio,this.UnitsData.parame.unit=e.namecode,this.UnitsData.parame.unitBit=e.data,this.unitForm.dialogVisible=!0}else this.$message({message:"该商品暂无更多单位可选",type:"warning"})},unitSelect:function(){var t=this.UnitsData.list[this.UnitsData.index];this.UnitsData.conversionRatio=t.conversionRatio,this.UnitsData.parame.unit=t.namecode,this.UnitsData.parame.unitBit=t.data},resetUnit:function(){this.unitForm.dialogVisible=!1},updateUnit:function(){var t=this;if(3===this.clickUnit_type){this.GoodsModifyDemo.data.unit_modify=this.UnitsData.parame.unit,this.GoodsModifyDemo.data.price_modify=this.count_price2(this.GoodsModifyDemo.data.price_demo,this.UnitsData.parame.unitBit);var e=this.count_price2(this.GoodsModifyDemo.data.num_modify,this.GoodsModifyDemo.data.unitbit_d);return e=this.count_price(e,this.UnitsData.parame.unitBit),this.GoodsModifyDemo.data.num_modify=e,this.GoodsModifyDemo.data.unitbit_d=this.UnitsData.parame.unitBit,void this.resetUnit()}Object(s["D"])(this.UnitsData.parame).then((function(e){200===e.code&&(t.$message({message:"修改单位成功！",type:"success"}),t.getProductionPlanDetailList(t.parameterDetail),t.resetUnit())}))},clickPrice:function(t){this.PriceForm.row=t,this.PriceForm.unitbit=t.unitbit,this.PriceForm.val=t.price,this.PriceForm.id=t.id,this.PriceForm.dialogVisible=!0},resetPrice:function(){this.PriceForm.dialogVisible=!1},updatePrice:function(){var t=this,e={amount:Math.ceil(100*this.PriceForm.val*this.PriceForm.row.num)/100,price:this.count_price(this.PriceForm.val,this.PriceForm.unitbit)};Object(s["b"])(e,this.PriceForm.id).then((function(e){200===e.code&&(t.$message({message:"修改单价成功！",type:"success"}),t.getProductionPlanDetailList(t.parameterDetail),t.resetPrice())}))},getFactoryList:function(){var t=this;Object(s["g"])().then((function(e){t.loadingWeb=!1,200===e.code?t.manualOptions=e.data:t.$message({message:e.message,type:"warning"})}))},setTable:function(t){var e=this;this.paramData=t,Object(s["r"])(t).then((function(t){if(e.loadingWeb=!1,200===t.code){var a=t.data.list;a.forEach((function(t){t.cancelReason="",t.vdata&&(t.cancelReason=t.vdata.cancelReason||"")})),e.currentPage=t.data.pageNum,e.loadingTab=!1,e.allTate=t.data.total,e.tableData=a,t.data.list.length>2&&""!==e.formQuery.factoryId?e.istruenew=!1:e.istruenew=!0}else e.$message({message:t.message,type:"warning"})}))},onSubmit:function(){var t=this.formQuery;100600===t.nodetype||[100601,100602,100612].indexOf(t.nodetype)>=0?this.searchCleOderBool=!1:this.searchCleOderBool=!0;var e=Object(l["a"])(Object(l["a"])({},t),{},{pageSize:this.paramData.pageSize});delete e.timeData,e.factoryId||delete e.factoryId,e.nodetype||delete e.nodetype,e.productName||delete e.productName,this.setTable(e)},getTimeData:function(t){var e=new Date(t),a=e.getFullYear()+"-"+this.p(e.getMonth()+1)+"-"+this.p(e.getDate()),i=this.p(e.getHours())+":"+this.p(e.getMinutes())+":"+this.p(e.getSeconds());return a+" "+i},p:function(t){return t<10?"0"+t:t},clickManual:function(){this.dialogManual=!0},clickManualGoods:function(){this.dialogFormManual=!0},ChooseFactory:function(){var t={factoryId:this.manualId};this.getSelectProductPartInfo(t)},getSelectProductPartInfo:function(t){var e=this;Object(s["x"])(t).then((function(t){e.loadingWeb=!1,200===t.code?e.dataManual=t.data.map((function(t){return t.states=!1,t})):e.$message({message:t.message,type:"warning"})}))},clicPlanGoods:function(t){this.$message({type:"success",message:"添加成功!"}),this.newDataManual.push(t),t.states=!0},putPurchase:function(){var t=this.formManual,e=this.newDataManual,a=Object(l["a"])(Object(l["a"])({factoryId:this.manualId},t),{},{productInfoList:e});e.length?(this.getProductionPlanInsert(a),this.dialogManual=!1,this.newDataManual=[],this.dataManual=[],this.manualId=""):this.$message({type:"warning",message:"请添加工厂商品!"})},getProductionPlanInsert:function(t){var e=this;Object(s["q"])(t).then((function(t){e.loadingWeb=!1,200===t.code?e.$message({type:"success",message:"添加成功!"}):e.$message({message:t.message,type:"warning"})}))},clickFactoryPlan:function(){this.$message({message:"正在开发中",type:"warning"})},clickApproval:function(){if(this.table_id_arr.length){this.idList=this.table_id_arr.toString();var t={I_optType:1,I_ids:this.idList,I_rovaluser:this.name};if([100601,100612].indexOf(this.paramData.nodetype)>=0)t.I_optType=1;else if(100602===this.paramData.nodetype)t.I_optType=2;else{if(!([100600,100611].indexOf(this.paramData.nodetype)>=0))return void this.$message({type:"warning",message:"当前状态对应审核还在开发中！"});t.I_optType=0}this.getProductionPlanAudit(t)}else this.$message({type:"warning",message:"请您选择要操作的数据！"})},getProductionPlanAudit:function(t){var e=this;Object(s["o"])(t).then((function(t){e.loadingWeb=!1,200===t.code?0===t.data[0].flag?(e.$message.success(t.data[0].result),e.paramData.page=1,e.setTable(e.paramData)):e.$message.warning(t.data[0].result):e.$message({message:t.message,type:"warning"})}))},clickExport:function(){var t=this,e=this.formQuery,a=Object(l["a"])({},e);delete a.timeData,a.nodetype||delete a.nodetype,a.factoryId||delete a.factoryId,a.productName||delete a.productName,e.timeData?Object(s["i"])(a).then((function(e){200===e.code?(t.ExportHints=e.data,t.dialogExport=!0):t.dialogExport=!1})):this.$message({type:"warning",message:"请选择导出的时间跨度 ^_^"})},dialogExportClick:function(){this.dialogExport=!1,this.$message({type:"success",message:"操作成功"})},clickDate:function(t,e){this.statyNum=e,this.dialogVisibleDate=!0,this.latestDataTime="",this.stateName=2===e?"备注":"最迟交货期",this.latestDataTimeId=t},clickDates:function(){var t=this,e=this.statyNum;if(2!==e){var a={targetId:this.latestDataTimeId.id,lastDeliveryDate:this.latestDataTime};Object(s["B"])(a).then((function(e){if(200===e.code){t.dialogVisibleDate=!1;for(var a=t.tableData,i=0;i<a.length;i++)a[i].id===t.latestDataTimeId&&(a[i].lastdate=t.latestDataTime);t.$message({type:"success",message:"成功设置最迟交货时间"}),("100600"===t.latestDataTimeId.nodetype||"100601"===t.latestDataTimeId.nodetype)&&t.setTable(t.paramData)}}))}else{var i=this.latestDataTimeId.vdata||{};i.postil=this.stateInput;var n={id:this.latestDataTimeId.id,remarks:this.stateInput,postscript:i};Object(s["y"])(n).then((function(e){200===e.code&&(t.dialogVisibleDate=!1,t.setTable(t.paramData),t.$message({type:"success",message:"成功添加备注"}),t.stateInput="")}))}},clickDetail:function(t){this.RejectPostil=t.postil,this.unitForm.optdate=t.optdate,this.doubleAuditTime=t.doubleAuditTime,this.doubleAuditTimes=t.auditTime,this.outerVisible=!0,this.idLists=t.id,this.Plannedtime="";var e={id:t.id};this.parameterDetail=e,this.getProductionPlanDetailList(e)},getProductionPlanDetailList:function(t){var e=this;this.loadingVisible=!0,this.rejectVal="",Object(s["p"])(t).then((function(t){e.loadingVisible=!1,200===t.code&&(e.ProductionDetailsList=t.data.productionPlanDetailList.list.map((function(t){return t.remarks="",t.script="",t.vdata&&(t.vdata=JSON.parse(t.vdata),t.script=t.vdata.script||""),t})),e.ProductionPlanDetailList=t.data,e.ProductionPlanDetailList.vdata=JSON.parse(e.ProductionPlanDetailList.vdata),null===e.ProductionPlanDetailList.planTime&&(e.Plannedtime=e.unitForm.optdate))}))},materialClick:function(t){var e=this;this.materialSettype=t.settype,this.dialogMaterial=!0;var a={productionPlanId:t.id,purchaseType:t.settype};Object(s["t"])(a).then((function(t){200===t.code?e.MaterialDetailsList=t.data:e.$message({type:"warning",message:t.message})}))},clickPostil:function(t){this.innerVisibleRow=t,this.innerVisibleInput=t.script,this.innerVisibleOrder=!0},clickPostils:function(){var t=this;if(""!==this.innerVisibleInput){var e={id:this.innerVisibleRow.id,postscript:{script:this.innerVisibleInput},remarks:"{script:"+this.innerVisibleInput+"}"};Object(s["z"])(e).then((function(e){200===e.code&&(t.$message.success(e.message),t.$emit("UpTable"),t.innerVisibleOrder=!1,t.getProductionPlanDetailList(t.parameterDetail))}))}else this.$message.warning("备注内容不能为空")},detailAudit:function(){var t=this;this.$confirm("是否确认审批","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={I_optType:1,I_ids:t.idLists,I_rovaluser:t.name};if(["100601","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0)e.I_optType=1;else if("100602"===t.ProductionPlanDetailList.nodetype)e.I_optType=2;else{if(!(["100600","100611"].indexOf(t.ProductionPlanDetailList.nodetype)>=0))return void t.$message({type:"warning",message:"当前生产计划的审批功能还在开发中！"});e.I_optType=0}Object(s["o"])(e).then((function(e){200===e.code?(t.$message({type:"success",message:e.message}),t.setTable(t.paramData),t.outerVisible=!1):t.$message({type:"warning",message:e.message})}))})).catch((function(){t.$message({type:"info",message:"已取消审批"})}))},clickACustomerOrder:function(t){var e=this;this.dialogCustomerOrder=!0;var a={associateId:t};Object(s["e"])(a).then((function(t){e.CustomerOrderList=t.data.list}))},clickPackaging:function(t){var e=this;this.dialogPackaging=!0;var a={associateId:t.id};Object(s["j"])(a).then((function(t){e.PackagingList=t.data.list}))},clickProduction:function(t){var e=this;this.dialogProduction=!0;var a={associateId:t};Object(s["n"])(a).then((function(t){e.ProductionList=t.data.list}))},getFactoryName:function(){var t=this;Object(d["o"])({}).then((function(e){if(200===e.code){var a=[];e.data.forEach((function(t){1!==t.data&&a.push(t)})),t.FactoryNameList=a}}))},getProdorderPaymentList:function(t){var e=this;Object(s["l"])(t).then((function(t){200===t.code&&(e.PaymentRecordsList=t.data.list)}))},clickPaymentRecords:function(t){var e={rela:t.id};this.dialogPaymentRecords=!0,this.getProdorderPaymentList(e),this.AddRelaId=t.id,this.PayEditFactoryName=t.factoryName,this.manufacturerId=t.factoryId},PayhandleEdit:function(t){var e=this,a={id:t};Object(s["u"])(a).then((function(t){200===t.code?e.PayEditForm=t.data:e.$message({type:"warning",message:t.message})})),this.dialogPayEdit=!0,this.EditPayId=t},editPayDialogClosed:function(){this.$refs.editPayFormRef.resetFields()},dialogPayEditSave:function(){var t=this;this.$refs.editPayFormRef.validate(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(a){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=Object(l["a"])(Object(l["a"])({},t.PayEditForm),{},{rela:t.AddRelaId,data:t.manufacturerId,inman:t.userId,id:t.EditPayId}),e.next=4,Object(s["w"])(i).then((function(e){200===e.code?t.$message({type:"success",message:e.message}):t.$message({type:"warning",message:e.message})}));case 4:t.dialogPayEdit=!1,n={rela:t.AddRelaId},t.getProdorderPaymentList(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},PayhandleDelete:function(t){var e=this;this.$confirm("是否删除该支付记录？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={id:t},a.next=3,Object(s["f"])(i).then((function(t){200===t.code?e.$message({type:"success",message:t.message}):e.$message({type:"warning",message:t.message})}));case 3:n={rela:e.AddRelaId},e.getProdorderPaymentList(n);case 5:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},onSubmitPay:function(){var t=this.formQueryInfo;if(t.timeData){if(t.timeData.length){var e=t.timeData[0],a=t.timeData[1];t.startDate=e,t.endDate=a}}else delete t.startDate,delete t.endDate;var i=Object(l["a"])({},t);delete i.timeData,i.productId||delete i.productId,this.paramData=i},clickPayAdd:function(){this.dialogPayAdd=!0},AddPayDialogClosed:function(){this.$refs.AddPayFormRef.resetFields()},PayAddClick:function(){var t=this;this.$refs.AddPayFormRef.validate(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(a){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=Object(l["a"])(Object(l["a"])({},t.formPayAdd),{},{rela:t.AddRelaId,data:t.manufacturerId,inman:t.userId}),e.next=4,Object(s["w"])(i).then((function(e){200===e.code?t.$message({type:"success",message:e.message}):t.$message({type:"warning",message:e.message})}));case 4:t.dialogPayAdd=!1,n={rela:t.AddRelaId},t.getProdorderPaymentList(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},clickDelivery:function(){this.$message({message:"正在开发中",type:"warning"})},clickNotation:function(){this.$message({message:"正在开发中",type:"warning"})},clickSizeChange:function(t){this.paramData.pageSize=t,this.clickCurrentChange(1)},clickCurrentChange:function(t){this.paramData.page=t,this.setTable(this.paramData)},handleSelectionChange:function(t){this.approvalList=t;var e=t.map((function(t){return t.id}));this.idList=e,this.table_id_arr=this.idList,this.multipleSelection=t},clickFactory:function(){this.dialogFactory=!0},delePurchase:function(t){var e=this;this.$confirm("此操作将删除商品信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(u["a"])(e.newDataManual,t),e.$message({type:"success",message:"删除成功!"})})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},clickGoods:function(){this.innerVisibleGoods=!0},add:function(){this.info.isTrue=!0,this.info.isShow=!0},viewDetail:function(){this.info.isTrue=!0,this.info.isShow=!0}},mounted:function(){},activated:function(){var t=this;setTimeout((function(){t.$refs.TableData.bodyWrapper.scrollTop=t.scrollTop,t.$refs.TableData.bodyWrapper.scrollLeft=t.scrollLeft}),60)},beforeRouteLeave:function(t,e,a){this.scrollTop=this.$refs.TableData.bodyWrapper.scrollTop,this.scrollLeft=this.$refs.TableData.bodyWrapper.scrollLeft,a()}},g=f,y=(a("6827"),a("2877")),b=Object(y["a"])(g,i,n,!1,null,"7b8e9d78",null);e["default"]=b.exports},4795:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return n}));a("a434");function i(t){var e=new Date(t),a=e.getMonth()+1,i=e.getDate();a>=1&&a<=9&&(a="0"+a),i>=0&&i<=9&&(i="0"+i);var n=e.getFullYear()+"-"+a+"-"+i+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return n}function n(t,e){for(var a=t.length,i=0;i<a;i++)if(t[i].id===e)return 0===i?(t.shift(),t):i===a-1?(t.pop(),t):(t.splice(i,1),t)}},6827:function(t,e,a){"use strict";a("89fe")},"89fe":function(t,e,a){}}]);