(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-396f429a"],{"9d21":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main-conent main-conent-minheight"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("el-form",{attrs:{"label-width":"100px"}},[i("el-row",{staticClass:"flex-wrap-wrap",attrs:{type:"flex",justify:"end"}},[i("el-col",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[i("el-form-item",{attrs:{label:"资源名称："}},[i("el-input",{model:{value:e.namecode,callback:function(t){e.namecode=t},expression:"namecode"}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[i("el-form-item",{attrs:{label:"资源代码："}},[i("el-input",{model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[i("el-form-item",{attrs:{label:"类型："}},[i("el-select",{attrs:{"value-key":"form.dataName",placeholder:"请选择"},model:{value:e.nodetype,callback:function(t){e.nodetype=t},expression:"nodetype"}},[i("el-option",{attrs:{label:"全部",value:""}}),i("el-option",{attrs:{label:"主菜单类型",value:"101202"}}),i("el-option",{attrs:{label:"页面内按钮类型",value:"101203"}}),i("el-option",{attrs:{label:"数据字段类型",value:"101204"}}),i("el-option",{attrs:{label:"接口类型",value:"101205"}})],1)],1)],1),i("el-col",{staticClass:"text-right",attrs:{xs:24,sm:24,md:12,lg:6,xl:6}},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getList()}}},[e._v("查询")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add(0)}}},[e._v("添加顶级资源")])],1)],1)],1),i("el-row")],1),i("v-add",{ref:"add",attrs:{info:e.info}}),i("v-list",{attrs:{data:e.data,info:e.info},on:{edit:e.edit,add:e.add}})],1)},n=[],o=i("5530"),r=(i("d3b7"),i("159b"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:e.info.isEdit?"修改资源":"添加资源",visible:e.info.isTrue,width:"50%"},on:{"update:visible":function(t){return e.$set(e.info,"isTrue",t)},close:function(t){return e.hide()}}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[i("el-form-item",{attrs:{label:"当前最大资源ID：",prop:"namecode"}},[e._v(" "+e._s(e.maxid)+" ")]),i("el-form-item",{attrs:{label:"资源ID：",prop:"id"}},[i("el-input",{attrs:{disabled:e.idDisabled},model:{value:e.maxidNew,callback:function(t){e.maxidNew=t},expression:"maxidNew"}})],1),i("el-form-item",{attrs:{label:"资源名称：",prop:"namecode"}},[i("el-input",{model:{value:e.form.namecode,callback:function(t){e.$set(e.form,"namecode",t)},expression:"form.namecode"}})],1),i("el-form-item",{attrs:{label:"所属应用：",prop:"rela"}},[i("el-select",{attrs:{"value-key":"form.roleType"},model:{value:e.form.rela,callback:function(t){e.$set(e.form,"rela",t)},expression:"form.rela"}},e._l(e.lists,(function(e){return i("el-option",{key:e.id,attrs:{label:e.namecode,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"类型：",prop:"nodetype"}},[i("el-select",{attrs:{"value-key":"form.dataName"},model:{value:e.form.nodetype,callback:function(t){e.$set(e.form,"nodetype",t)},expression:"form.nodetype"}},[i("el-option",{attrs:{label:"角色类型",value:"101201"}}),i("el-option",{attrs:{label:"主菜单类型",value:"101202"}}),i("el-option",{attrs:{label:"页面内按钮类型",value:"101203"}}),i("el-option",{attrs:{label:"数据字段类型",value:"101204"}}),i("el-option",{attrs:{label:"接口类型",value:"101205"}})],1)],1),i("el-form-item",{attrs:{label:"链接地址："}},[i("el-input",{model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.edit("ruleForm")}}},[e._v("保存")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.hide()}}},[e._v("取 消")])],1)],1)],1)}),l=[],s=i("b418"),d=i("373f"),c={props:["info"],data:function(){return{idDisabled:!1,maxidNew:"",maxid:"",maxidNewIf:!1,lists:[],form:{rela:10005,url:"",data:0,namecode:"",top:0,nodetype:"101203"},rules:{nodetype:[{required:!0,message:"请选择类型",trigger:"blur"}],rela:[{required:!0,message:"请选择所属应用",trigger:"blur"}],namecode:[{required:!0,message:"请输入资源名称",trigger:"change"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}]}}},methods:{getMaxId:function(){var e=this;Object(s["k"])().then((function(t){200===t.code&&(e.maxid=t.data,e.maxidNewIf&&(e.maxidNewIf=!1,e.maxidNew=e.maxid+1))}))},reset:function(){this.form={rela:10005,url:"",data:0,namecode:"",top:0,nodetype:"101203"}},getParentId:function(e){var t=this;this.maxidNewIf=!0,this.maxidNew=this.maxid+1,this.getMaxId();var i={id:e};this.idDisabled=!1,Object(s["c"])(i).then((function(e){e.data.length>0&&(0!==e.data[0].top?t.form.top=e.data[0].top:t.form.top=e.data[0].id)})),this.form.data=e},getId:function(e){var t=this,i={id:e};Object(s["c"])(i).then((function(i){t.idDisabled=!0,t.maxidNew=e,t.form=i.data[0]}))},hide:function(){this.info.isTrue=!1,this.reset()},edit:function(e){var t=this,i=this.form;delete this.form.appName,delete this.form.lastname,this.$refs[e].validate((function(e){if(!e)return!1;i.id=t.maxidNew,i.isedit=t.info.isEdit,Object(s["v"])(i).then((function(e){if(200===e.code){if(!e.flag)return void t.$message({message:"操作失败、可能资源id或资源名称重复",type:"warning"});Object(d["a"])(e.message),Object(s["r"])(),t.hide(),t.$parent.getList()}}))}))},roleAdd:function(){var e=this;Object(s["roleAdd"])(this.form).then((function(t){200===t.code&&(Object(d["a"])(t.message),Object(s["r"])(),e.reqChangeList(),e.hide())}))}},mounted:function(){var e=this,t={getColumns:[{nameCode:"id"},{nameCode:"namecode"}],Condition:[{nameCode:"rela",data:101}]};Object(s["b"])(t).then((function(t){e.lists=t.data}))},created:function(){this.getMaxId()}},u=c,f=i("2877"),m=Object(f["a"])(u,r,l,!1,null,"137cc622",null),p=m.exports,h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.data,"row-key":"id",border:"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[i("el-table-column",{attrs:{prop:"namecode",label:"资源名称",sortable:"",width:"360px"}}),i("el-table-column",{attrs:{prop:"id",label:"资源代码",sortable:"",align:"center",width:"150"}}),i("el-table-column",{attrs:{prop:"appName",label:"所属应用",align:"center"}}),i("el-table-column",{attrs:{label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["101202"==t.row.nodetype?i("div",[e._v("主菜单类型")]):e._e(),"101203"==t.row.nodetype?i("div",[e._v("页面内按钮类型")]):e._e(),"101204"==t.row.nodetype?i("div",[e._v("数据字段类型")]):e._e(),"101205"==t.row.nodetype?i("div",[e._v("接口类型")]):e._e()]}}])}),i("el-table-column",{attrs:{prop:"url",label:"Url",align:"center"}}),i("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.add(t.row.id)}}},[e._v("添加子项")]),i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.edit(t.row.id)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"danger"},on:{click:function(i){return e.del(t.row.id)}}},[e._v("删除")])],1)]}}])})],1)],1)},b=[],v=(i("c740"),i("a434"),i("c733"),1e3),g={props:["data","info"],components:{},data:function(){return{}},computed:{},methods:{add:function(e){this.$emit("add",e),this.info.isTrue=!0,this.info.isEdit=!1},del:function(e){var t=this;this.$confirm("确认要删除该权限吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["u"])(e).then((function(e){200===e.code&&(Object(s["r"])(),Object(d["a"])(e.message),t.$parent.getList())}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},edit:function(e){this.info.isEdit=!0,this.info.isTrue=!0,this.$emit("edit",e)},append:function(e){var t={id:v++,namecode:"testtest",children:[]};e.children||this.$set(e,"children",[]),e.children.push(t)},remove:function(e,t){var i=e.parent,a=i.data.children||i.data,n=a.findIndex((function(e){return e.id===t.id}));a.splice(n,1)},handleSelectionChange:function(e){this.multipleSelection=e}},created:function(){},mounted:function(){},updated:function(){}},x=g,y=Object(f["a"])(x,h,b,!1,null,"1f6dfca2",null),w=y.exports,k=i("2f62"),_={components:{vAdd:p,vList:w},data:function(){return{namecode:"",nodetype:"",id:"",list:{},pageNo:1,data:[],info:{isTrue:!1,isEdit:!1}}},computed:Object(o["a"])({},Object(k["c"])({})),methods:Object(o["a"])(Object(o["a"])({},Object(k["b"])({})),{},{getList:function(){var e=this,t={largeId:0};""!==this.id&&this.$set(t,"id",this.id),""!==this.namecode&&this.$set(t,"namecode","%"+this.namecode+"%"),""!==this.nodetype?this.$set(t,"nodetype",this.nodetype):(this.$set(t,"nodetype1","101201"),this.$set(t,"nodetype2","101206")),Object(s["c"])(t,0).then((function(t){var i=[];t.data.forEach((function(e){var t={id:e.id,namecode:e.namecode,nodetype:e.nodetype,url:e.url,appName:e.appName,parentid:e.data,children:[]};i.push(t)}));var a=e.listToTree("id","parentid",i);e.data=a}))},exists:function(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t)return!0;return!1},listToTree:function(e,t,i){for(var a=[],n=0;n<i.length;n++){var o=i[n];this.exists(i,o[t])||a.push(o)}for(var r=[],l=0;l<a.length;l++)r.push(a[l]);while(r.length)for(var s=r.shift(),d=0;d<i.length;d++){var c=i[d];c[t]===s[e]&&(s.children?s.children.push(c):s.children=[c],r.push(c))}return a},add:function(e){this.info.isTrue=!0,this.info.isEdit=!1,this.$refs.add.getParentId(e)},edit:function(e){this.info.isEdit=!0,this.info.isTrue=!0,this.$refs.add.getId(e)}}),mounted:function(){this.getList()}},$=_,j=Object(f["a"])($,a,n,!1,null,null,null);t["default"]=j.exports},c733:function(e,t,i){"use strict";var a=i("2b0e");t["a"]=new a["default"]}}]);