(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12791e2f"],{"304e":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main-conent main-conent-minheight flex-main-conent"},[a("div",{staticClass:"flex-box"},[a("div",{staticClass:"flex-top"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-row",{staticClass:"flex-wrap-wrap",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{xs:10,sm:10,md:5,lg:5,xl:5}},[a("el-form-item",{attrs:{label:"角色名称："}},[a("el-input",{model:{value:e.namecode,callback:function(t){e.namecode=t},expression:"namecode"}})],1)],1),a("el-col",{attrs:{xs:24,sm:12,md:12,lg:8,xl:8}},[a("el-form-item",{attrs:{label:"所属部门："}},[a("el-select",{attrs:{"value-key":"form.roleType",placeholder:"请选择"},model:{value:e.dept,callback:function(t){e.dept=t},expression:"dept"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.deptList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.namecode,value:e.id}})}))],2)],1)],1),a("el-col",{staticClass:"text-right",attrs:{xs:24,sm:12,md:12,lg:8,xl:8}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.findList(0)}}},[e._v("查询")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add()}}},[e._v("添加角色")])],1)],1)],1),a("el-row")],1)]),a("div",{staticClass:"flex-cont"},[a("v-list",{attrs:{lists:e.lists,info:e.info},on:{edit:e.edit,editauth:e.editauth}})],1),a("div",{staticClass:"flex-button"},[a("div",{staticClass:"margin-t16 text-right"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.findList(0)}}},[e._v("第一页")]),e.pageNo>1?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.findList(-1)}}},[e._v("上一页")]):e._e(),e.lists.length>=24?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.findList(1)}}},[e._v("下一页")]):e._e(),e.lists.length<24?a("el-button",{attrs:{type:"primary"}},[e._v("已经是最后一页")]):e._e()],1)])]),a("v-authlist",{attrs:{info:e.info}}),a("v-add",{ref:"aaa",attrs:{info:e.info}})],1)},n=[],o=a("5530"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:e.info.isShow?"添加角色":"修改角色",visible:e.info.isTrue,width:"50%"},on:{"update:visible":function(t){return e.$set(e.info,"isTrue",t)},close:function(t){return e.hide()}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"角色名称：",prop:"namecode"}},[a("el-input",{model:{value:e.form.namecode,callback:function(t){e.$set(e.form,"namecode",t)},expression:"form.namecode"}})],1),a("el-form-item",{attrs:{label:"所属部门：",prop:"data"}},[a("el-select",{attrs:{"value-key":"form.roleType"},model:{value:e.form.data,callback:function(t){e.$set(e.form,"data",t)},expression:"form.data"}},e._l(e.lists,(function(e){return a("el-option",{key:e.id,attrs:{label:e.namecode,value:e.id}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.roleEdit("ruleForm")}}},[e._v("保存")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.hide()}}},[e._v("取 消")])],1)],1)],1)},r=[],d=a("2f62"),l=a("b418"),c=a("2cd9"),u=a("373f"),h={props:["info"],data:function(){return{uploadUrl:c["b"],form:{namecode:"",nodetype:101201},rules:{data:[{required:!0,message:"请选择角色分类",trigger:"change"}],namecode:[{required:!0,message:"请输入角色名称",trigger:"change"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]}}},computed:Object(o["a"])({},Object(d["c"])({lists:"roleList/roleTypeList"})),methods:Object(o["a"])(Object(o["a"])({},Object(d["b"])({reqChangeList:"roleList/reqChangeList"})),{},{reset:function(){this.form={namecode:"",nodetype:101201}},hide:function(){this.info.isTrue=!1,this.reset()},getId:function(e){var t=this;Object(l["w"])({getColumns:[{nameCode:"id"},{nameCode:"data"},{nameCode:"nodetype"},{nameCode:"namecode"},{rela:"m0_res_power",nodeType:"data",nameCode:"namecode",vdata:{DISPNAME:"roleType"}},{rela:"unif",nodeType:"rela",nameCode:"namecode",vdata:{DISPNAME:"dataName"}}],Condition:[{nameCode:"id",data:e},{nameCode:"nodetype",data:"101201"}]}).then((function(e){if(200===e.code){var a=e.data[0];t.form=a}else Object(u["b"])("网络故障")}))},roleEdit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a=t.form;delete a.roleType,delete a.dataName,delete a.rolename,a.isedit=!t.info.isShow,Object(l["v"])(a).then((function(e){200===e.code?e.flag?(Object(u["a"])(e.message),t.$parent.findList(),t.hide()):Object(u["b"])("该部门下已存在该角色!"):Object(u["b"])(e.message)}))}))},roleAdd:function(){var e=this;Object(l["roleAdd"])(this.form).then((function(t){200===t.code&&(Object(u["a"])(t.message),e.$parent.findList(),e.hide())}))}}),mounted:function(){}},f=h,p=a("2877"),m=Object(p["a"])(f,s,r,!1,null,"23c1844c",null),b=m.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"100%"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.lists,border:"",height:"100%"}},[a("el-table-column",{attrs:{prop:"id",label:"标识",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"namecode",label:"角色名称",width:"250",align:"center"}}),a("el-table-column",{attrs:{prop:"roleType",label:"部门",align:"center",width:"250"}}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.edit(t.row.id)}}},[e._v("修改")]),a("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.editauth(t.row)}}},[e._v("权限配置")]),a("el-button",{attrs:{type:"danger"},on:{click:function(a){return e.del(t.row)}}},[e._v("删除")])],1)]}}])})],1)],1)},g=[],y=a("c733"),L={props:["lists","info","authList"],components:{},data:function(){return{}},computed:Object(o["a"])({},Object(d["c"])({list:"roleList/list"})),methods:Object(o["a"])(Object(o["a"])({},Object(d["b"])({reqChangeList:"roleList/reqChangeList"})),{},{edit:function(e){this.$emit("edit",e)},editauth:function(e){y["a"].$emit("myFunRole",e),this.$emit("editauth",e)},del:function(e){var t=this,a=new Date;if(a.setDate(a.getDate()-3),new Date(e.optdate)<a)return Object(u["b"])("超过72小时的数据不允许删除！"),!1;var i=e.id;this.$confirm("确认要删除该角色吗？请确认该角色没有关联用户!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["u"])(i).then((function(e){200===e.code&&(Object(u["a"])(e.message),t.$parent.findList())}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}}),mounted:function(){this.reqChangeList()}},C=L,k=Object(p["a"])(C,v,g,!1,null,"cc5cc3e0",null),w=k.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"角色授权",visible:e.info.authDis,width:"60%",top:"60px"},on:{"update:visible":function(t){return e.$set(e.info,"authDis",t)}}},[a("div",{staticStyle:{overflow:"auto",height:"500px"}},[a("div",{attrs:{id:"app"}},[a("el-tree",{ref:"tree",attrs:{"default-expand-all":"",data:e.dataList,"show-checkbox":"","node-key":"id","check-strictly":!0},on:{check:e.checkChange}})],1)])]),a("el-dialog",{attrs:{title:"字段授权",visible:e.fieldsShow,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.fieldsShow=t}}},[a("el-form",{ref:"form",attrs:{"label-width":"100px"}},[a("el-checkbox-group",{model:{value:e.checkedList,callback:function(t){e.checkedList=t},expression:"checkedList"}},e._l(e.fieldList,(function(t){return a("el-checkbox",{key:t,attrs:{label:t},on:{change:function(a){return e.fieldChangeCheckbox(a,t)}},model:{value:e.checkedList,callback:function(t){e.checkedList=t},expression:"checkedList"}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1)],1)},x=[],j=(a("b0c0"),a("d3b7"),a("159b"),a("a9e3"),a("e9c4"),a("a434"),{props:["info"],components:{},data:function(){return{fieldList:[],dataList:[],parentId:"",vdataList:[],fieldsShow:!1,checkedList:[],defaultProps:{children:"children",label:"label"}}},computed:{},mounted:function(){var e=this;y["a"].$on("myFunRole",(function(t){e.id=t.id,e.name=t.namecode;e.getvdataList(),e.getList(),e.setCheckedKeys()}))},methods:{getvdataList:function(){var e=this;Object(l["a"])({rela:this.id,vdata:""},0).then((function(t){e.vdataList=t.data}))},setCheckedKeys:function(e){var t=this;Object(l["a"])({rela:this.id},0).then((function(e){var a=[];e.data.forEach((function(e){a.push(e.data)})),t.$refs.tree.setCheckedKeys(a)}))},handleClose:function(e){this.reset(),this.getvdataList(),this.getList(),this.setCheckedKeys(),this.fieldsShow=!1},reset:function(){this.fieldModel=[],this.dataList=[],this.parentId="",this.vdataList=[],this.fieldsShow=!1,this.checkedList=[]},getList:function(){var e=this,t={largeId:0,nodetype1:101201,nodetype2:101206};Object(l["c"])(t,0).then((function(t){var a=[];t.data.forEach((function(t){var i="";void 0!==t.vdata&&(i=t.vdata),e.vdataList.some((function(e,a){e.data==t.id&&(i+="[-已授权:"+e.vdata+"]")}));var n=101203===Number(t.nodetype)?" - [ 按钮 ] ":"";n="";var o={id:t.id,label:t.namecode+n+i,nodetype:t.nodetype,url:t.url,parentid:t.data,vdata:i,children:[]};a.push(o)}));var i=e.listToTree("id","parentid",a);e.dataList=i}))},getCheckedKeys:function(){},exists:function(e,t){for(var a=0;a<e.length;a++)if(e[a].id===t)return!0;return!1},listToTree:function(e,t,a){for(var i=[],n=0;n<a.length;n++){var o=a[n];this.exists(a,o[t])||i.push(o)}for(var s=[],r=0;r<i.length;r++)s.push(i[r]);while(s.length)for(var d=s.shift(),l=0;l<a.length;l++){var c=a[l];c[t]===d[e]&&(d.children?d.children.push(c):d.children=[c],s.push(c))}return i},fieldChangeCheckbox:function(e,t){var a=this;if(e){var i={allow:this.checkedList},n={id:this.parentId,vdata:JSON.stringify(i)};Object(l["C"])(n).then((function(e){}))}else{this.checkedList.some((function(e,i){if(e==t)return a.checkedList.splice(i,1),!0}));i={allow:this.checkedList},n={id:this.parentId,vdata:JSON.stringify(i)};Object(l["C"])(n).then((function(e){}))}},checkChange_1:function(){},checkChange:function(e){var t=this,a=this.$refs.tree.getNode(e);if(a.checked){var i={rela:this.id,namecode:this.name+":"+e.label,data:e.id,nodetype:101301};Object(l["o"])(i).then((function(i){if("101204"===e.nodetype&&(t.fieldsShow=!0,a.data.vdata.length>0)){t.parentId=i.data.newId;var n=JSON.parse(a.data.vdata);t.fieldList=n.s_fields}}))}else{var n={rela:this.id,data:e.id};Object(l["a"])(n,0).then((function(e){e.data.length>0&&Object(l["f"])(e.data[0].id)}))}},handleSelectionChange:function(e){this.multipleSelection=e}},created:function(){},updated:function(){}}),_=j,T=Object(p["a"])(_,O,x,!1,null,"310a64c6",null),S=T.exports,$={components:{vAdd:b,vList:w,vAuthlist:S},data:function(){return{dept:"",namecode:"",nodetype:101201,pageNo:1,lists:[],authList:[],info:{isTrue:!1,isShow:!0,authDis:!1}}},computed:Object(o["a"])({},Object(d["c"])({deptList:"roleList/roleTypeList"})),methods:Object(o["a"])(Object(o["a"])({},Object(d["b"])({reqChangeList:"roleList/reqChangeList"})),{},{editauth:function(){this.info.authDis=!0},add:function(){this.info.isTrue=!0,this.info.isShow=!0},edit:function(e){this.info.isShow=!1,this.info.isTrue=!0,this.$refs.aaa.getId(e)},findList:function(e){var t=this;0===e?this.pageNo=1:e>0?this.pageNo++:e<0&&this.pageNo--;var a=[];if(""!==this.dept){var i={nameCode:"data",data:this.dept};a.push(i)}if(""!==this.nodetype){var n={nameCode:"nodetype",data:this.nodetype};a.push(n)}if(""!==this.namecode){var o={nameCode:"namecode",data:"%"+this.namecode+"%",nodeType:"LIKE"};a.push(o)}var s={getColumns:[{nameCode:"id"},{nameCode:"data"},{nameCode:"nodetype"},{nameCode:"namecode"},{nameCode:"optdate"},{rela:"m0_res_power",nodeType:"data",nameCode:"namecode",vdata:{DISPNAME:"roleType"}},{rela:"unif",nodeType:"rela",nameCode:"namecode",vdata:{DISPNAME:"dataName"}},{nameCode:"id",nodeType:"ORDER DESC"}],Condition:a};Object(l["w"])(s,this.pageNo).then((function(e){t.lists=e.data}))}}),mounted:function(){this.findList(0)}},N=$,E=Object(p["a"])(N,i,n,!1,null,null,null);t["default"]=E.exports},c733:function(e,t,a){"use strict";var i=a("2b0e");t["a"]=new i["default"]}}]);