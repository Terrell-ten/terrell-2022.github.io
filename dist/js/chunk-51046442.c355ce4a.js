(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51046442"],{9138:function(t,e,i){"use strict";i("f7f2")},bfbb:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"warehouse main-conent flex-main-conent"},[i("div",{staticClass:"flex-box"},[i("div",{staticClass:"flex-top"},[i("el-form",{staticClass:"demo-form-inline",staticStyle:{"margin-bottom":"15px"},attrs:{inline:!0,model:t.formQuery}},[i("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"日期从："}},[i("div",{staticClass:"block"},[i("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",align:"right",placeholder:"开始日期","value-format":"yyyy-MM-dd","picker-options":{disabledDate:t.starDataMax}},model:{value:t.formQuery.startDate,callback:function(e){t.$set(t.formQuery,"startDate",e)},expression:"formQuery.startDate"}}),t._v(" - "),i("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",align:"right",placeholder:"结束时间","value-format":"yyyy-MM-dd","picker-options":{disabledDate:t.endDataMin}},model:{value:t.formQuery.endDate,callback:function(e){t.$set(t.formQuery,"endDate",e)},expression:"formQuery.endDate"}})],1)]),i("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"状态："}},[i("el-select",{attrs:{placeholder:"状态"},on:{change:function(e){return t.onSubmit()}},model:{value:t.formQuery.nodetype,callback:function(e){t.$set(t.formQuery,"nodetype",e)},expression:"formQuery.nodetype"}},t._l(t.statusList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.namecode,value:t.id}})})),1)],1),i("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"工厂名称："}},[i("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:t.formQuery.factoryId,callback:function(e){t.$set(t.formQuery,"factoryId",e)},expression:"formQuery.factoryId"}},t._l(t.FactoryNameList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.factoryName,value:t.id}})})),1)],1),i("el-form-item",{staticStyle:{"margin-right":"20px"}},[i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTab,expression:"loadingTab"}],attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onSubmit()}}},[t._v("查询")])],1),t.buttonPermissions.indexOf(10061)>=0?[i("el-form-item",{staticStyle:{"margin-right":"20px"}},[[100600,100611].indexOf(t.formQuery.nodetype)>=0?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.clickApproval()}}},[t._v(t._s([100600,100611].indexOf(t.formQuery.nodetype)>=0?"提交初审":[100601,100612].indexOf(t.formQuery.nodetype)>=0?"初审通过":100602==t.formQuery.nodetype?"复审通过":"同意批准"))]):t._e()],1)]:t._e(),[100601,100602].indexOf(t.formQuery.nodetype)>=0?i("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}}):t._e(),t.buttonPermissions.indexOf(10062)>=0?[[100600,100611].indexOf(t.formQuery.nodetype)>=0?i("el-form-item",{staticClass:"overall",staticStyle:{"margin-right":"30px"}},[i("el-button",{attrs:{type:"primary"},on:{click:t.goProductplan}},[t._v(t._s("计划生成"))])],1):t._e()]:t._e()],2)],1),i("div",{staticClass:"flex-cont"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTab,expression:"loadingTab"}],ref:"TableData",staticStyle:{width:"100%"},attrs:{data:t.tableData,height:"100%",stripe:"",border:"","highlight-current-row":""},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"40"}}),i("el-table-column",{attrs:{property:"id",label:"标识",width:"50",align:"center"}}),i("el-table-column",{attrs:{property:"orderNo",label:"生产订单号",align:"center"}}),i("el-table-column",{attrs:{property:"optName",label:"生成人",align:"center"}}),i("el-table-column",{attrs:{property:"factoryName",label:"工厂名称信息",align:"center"}}),i("el-table-column",{attrs:{property:"optdate",label:"计划时间",align:"center"}}),i("el-table-column",{attrs:{property:"amount",label:"加工总金额（元）",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.amount))])]}}])}),i("el-table-column",{attrs:{property:"materialAmount",label:"材料总费用（元）",align:"center"}}),i("el-table-column",{attrs:{property:"auditUser",label:"初审人",align:"center"}}),i("el-table-column",{attrs:{property:"auditTime",label:"初审时间",align:"center"}}),i("el-table-column",{attrs:{property:"doubleAuditUser",label:"复审人",align:"center"}}),i("el-table-column",{attrs:{property:"doubleAuditTime",label:"复审时间",align:"center"}}),i("el-table-column",{attrs:{property:"nodetypeName",label:"状态",align:"center"}}),i("el-table-column",{attrs:{property:"lastdate",label:"要求完成日期",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.lastdate?i("span",[t._v(" "+t._s(e.row.lastdate)+" "),["100600","100611"].indexOf(e.row.nodetype)>=0?i("el-link",{staticClass:"el-icon-edit",attrs:{type:"primary"},on:{click:function(i){return t.clickDate(e.row,1)}}}):t._e()],1):["100600","100611"].indexOf(e.row.nodetype)>=0?i("span",[i("el-link",{staticStyle:{cursor:"pointer",color:"dodgerblue"},on:{click:function(i){return t.clickDate(e.row,1)}}},[t._v("设置")])],1):t._e()]}}])}),i("el-table-column",{attrs:{property:"postil",label:"备注",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{attrs:{placement:"top"}},[i("div",{attrs:{slot:"content"},slot:"content"},[["100607"].indexOf(e.row.nodetype)>=0?i("span",[t._v(t._s(e.row.cancelReason))]):i("div",[t._v(t._s(e.row.postil?e.row.postil:"(点击修改)"))])]),["100600","100611"].indexOf(e.row.nodetype)>=0?[e.row.postil?i("span",[t._v(" "+t._s(t._f("postil_substring")(e.row.postil))+" "),i("i",{staticClass:"el-icon-edit",staticStyle:{color:"dodgerblue","margin-left":"2px",cursor:"pointer"},on:{click:function(i){return t.clickDate(e.row,2)}}})]):i("el-link",{staticStyle:{cursor:"pointer",color:"dodgerblue"},on:{click:function(i){return t.clickDate(e.row,2)}}},[t._v("备注")])]:i("span",[["100607"].indexOf(e.row.nodetype)>=0?i("span",[t._v(t._s(t._f("postil_substring")(e.row.cancelReason)))]):i("span",[t._v(t._s(t._f("postil_substring")(e.row.postil)))])])],2)]}}])}),i("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return t.clickDetail(e.row)}}},[t._v("查看明细")]),[100600,100611,100601,100602,100612].indexOf(t.paramData.nodetype)>=0&&t.buttonPermissions.indexOf(10085)>=0?i("el-button",{attrs:{type:"danger"},on:{click:function(i){return t.cancelProduction(1,e.row.id)}}},[t._v(t._s("取 消"))]):t._e()]}}])})],1)],1),i("div",{staticClass:"flex-button"},[i("div",{staticClass:"margin-t16 text-right"},[i("AppPaging",{attrs:{total:t.total,pageSize:t.paramData.pageSize,currentPage:t.paramData.page,layout:"total,sizes,prev, pager, next"},on:{handleCurrentChange:t.handleCurrentChange,handleSizeChange:t.handleSizeChange}})],1)])]),i("el-dialog",{attrs:{title:"生产计划单生成管理-查看明细",visible:t.outerVisible,width:"86%"},on:{"update:visible":function(e){t.outerVisible=e}}},[[i("div",{staticClass:" detail-top-flex"},[i("div",{staticClass:"detail-top-l"},[i("div",[t._v("生产订单号："+t._s(t.ProductionPlanDetailList.planCode))]),i("div",[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),i("div",[t._v("加工总金额："+t._s(t.ProductionPlanDetailList.amount)+"（元）")]),i("div",[t._v("材料总费用："+t._s(t.ProductionPlanDetailList.bomAmount)+"（元）")]),i("br"),i("div",[t._v("状态："+t._s(t.ProductionPlanDetailList.nodetypeName))]),i("div",[t._v("审核人："+t._s(t.ProductionPlanDetailList.auditUser))]),i("div",[t._v("审批时间："+t._s(null===t.doubleAuditTime?t.doubleAuditTimes:t.doubleAuditTime))]),i("div",[t._v("要求完成日期："+t._s(t.ProductionPlanDetailList.lastdate))]),i("br"),i("div",[t._v("备注："+t._s(t.ProductionPlanDetailList.vdata?t.ProductionPlanDetailList.vdata.postil:""))])]),["100600","100601","100611","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0?i("div",{staticClass:"detail-top-r"},[t.buttonPermissions.indexOf(10077)>=0?[[100600,100611,100601,100602,100612].indexOf(Number(t.ProductionPlanDetailList.nodetype))>=0?i("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.cancelProductionDetails(3)}}},[t._v("批量勾选取消")]):t._e()]:t._e()],2):t._e()])],i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingVisible,expression:"loadingVisible"}],staticStyle:{width:"100%"},attrs:{data:t.ProductionDetailsList,"max-height":"400px",stripe:"",border:""},on:{"selection-change":t.detailsSelectionChange}},[[100600,100611,100601,100602,100612].indexOf(Number(t.ProductionPlanDetailList.nodetype))>=0?i("el-table-column",{attrs:{type:"selection",width:"40"}}):t._e(),i("el-table-column",{attrs:{property:"id",label:"标识",width:"50",align:"center"}}),i("el-table-column",{attrs:{property:"namecode",label:"产品名称",align:"center",width:"200","show-overflow-tooltip":!0}}),i("el-table-column",{attrs:{property:"specif",label:"规格",align:"center"}}),i("el-table-column",{attrs:{property:"skuCode",label:"SKU",align:"center",width:"200"}}),i("el-table-column",{attrs:{property:"unit",label:"生产单位",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{},[i("span",[t._v(t._s(e.row.unit))])])]}}])}),i("el-table-column",{attrs:{property:"num",label:"生产数量",align:"center",width:"80"}}),i("el-table-column",{attrs:{property:"stock",label:"当前库存数",align:"center",width:"100"}}),i("el-table-column",{attrs:{property:"minStock",label:"最低库存",align:"center",width:"80"}}),i("el-table-column",{attrs:{property:"price",label:"单价（元）",align:"center",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{},[i("span",[t._v(t._s(e.row.price))])])]}}])}),i("el-table-column",{attrs:{property:"amount",label:"金额（元）",align:"center",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.amount))])]}}])}),i("el-table-column",{attrs:{property:"miniNum",label:"起订量",align:"center",width:"80"}}),i("el-table-column",{attrs:{property:"lossRate",label:"预损耗率",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(Number(100*e.row.lossRate).toFixed(2))+" %")])]}}])}),i("el-table-column",{attrs:{property:"nodetypeName",label:"状态",align:"center"}}),i("el-table-column",{attrs:{property:"script",label:"备注",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{attrs:{placement:"top"}},[i("div",{attrs:{slot:"content"},slot:"content"},[i("div",[t._v(t._s(e.row.script?e.row.script:"(点击修改)"))])]),i("span",[t._v(t._s(t._f("postil_substring")(e.row.script)))])])]}}])}),i("el-table-column",{attrs:{property:"postil",label:"操作",align:"center","min-width":"240",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[["100601","100602","100611","100612","100600"].indexOf(e.row.nodetype)>=0?i("el-button",{attrs:{disabled:"0"==e.row.settype},nativeOn:{click:function(i){return t.purchaseClick(e.row)}}},[t._v("查看材料")]):i("el-button",{attrs:{disabled:"0"==e.row.settype},nativeOn:{click:function(i){return t.materialClick(e.row)}}},[t._v("查看材料")]),t.buttonPermissions.indexOf(10063)>=0?[["100600","100611"].indexOf(t.ProductionPlanDetailList.nodetype)>=0?i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(i){return t.GoodsModifyOpen2(e.row)}}},[t._v("修改")]):t._e()]:t._e(),t.buttonPermissions.indexOf(10077)>=0?[["100600","100611","100601","100602","100612"].indexOf(e.row.nodetype)>=0?i("el-button",{attrs:{type:"danger"},on:{click:function(i){return t.cancelProductionDetails(1,e.row.id)}}},[t._v(t._s("取消"))]):t._e()]:t._e(),[["100605"].indexOf(t.ProductionPlanDetailList.nodetype)>=0?i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(i){return t.kafizhon(e.row)}}},[t._v("完成入库")]):t._e()]]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.buttonPermissions.indexOf(10061)>=0?[i("el-button",{directives:[{name:"show",rawName:"v-show",value:["100611","100600"].indexOf(t.ProductionPlanDetailList.nodetype)>=0,expression:"['100611','100600'].indexOf(ProductionPlanDetailList.nodetype)>=0"}],attrs:{size:"medium",type:"primary"},on:{click:t.detailAudit}},[t._v(" "+t._s({100600:"提交初审",100611:"提交初审",100601:"初审通过",100612:"初审通过",100602:"复审通过"}[t.ProductionPlanDetailList.nodetype]||"同意审批")+" ")])]:t._e(),i("el-button",{attrs:{size:"medium"},on:{click:function(e){t.outerVisible=!1}}},[t._v("返 回")])],2)],2),i("el-dialog",{attrs:{title:t.stateName,visible:t.dialogVisibleDate,width:"30%"},on:{"update:visible":function(e){t.dialogVisibleDate=e}}},[1==t.statyNum?i("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.latestDataTime,callback:function(e){t.latestDataTime=e},expression:"latestDataTime"}}):t._e(),2==t.statyNum?i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.stateInput,callback:function(e){t.stateInput=e},expression:"stateInput"}}):t._e(),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisibleDate=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.clickDates()}}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{visible:t.unitForm.dialogVisible,title:"修改生产单位",width:"20%","destroy-on-close":"",center:""},on:{"update:visible":function(e){return t.$set(t.unitForm,"dialogVisible",e)}},model:{value:t.unitForm.dialogVisible,callback:function(e){t.$set(t.unitForm,"dialogVisible",e)},expression:"unitForm.dialogVisible"}},[i("el-form",{ref:"unitForm",attrs:{rules:t.unitForm.rules,model:t.unitForm}},[i("el-form-item",{staticStyle:{width:"280px",margin:"auto","line-height":"1.6"}},[i("p",[t._v("当前单位："+t._s(t.unitForm.unit))]),t._v(" 修改至："),i("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.unitSelect()}},model:{value:t.UnitsData.index,callback:function(e){t.$set(t.UnitsData,"index",e)},expression:"UnitsData.index"}},t._l(t.UnitsData.list,(function(t,e){return i("el-option",{key:e,attrs:{label:t.namecode,value:e}})})),1),i("p",[t._v("单位配比："+t._s(t.UnitsData.conversionRatio))])],1),i("el-form-item",{staticStyle:{"margin-top":"30px"}},[i("div",{staticStyle:{width:"100%","margin-left":"auto","margin-right":"auto","text-align":"center"}},[i("el-button",{on:{click:function(e){return t.resetUnit("unitForm")}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateUnit("unitForm")}}},[t._v("确定")])],1)])],1)],1),i("el-dialog",{attrs:{visible:t.PriceForm.dialogVisible,title:"修改单价",width:"20%","destroy-on-close":"",center:""},on:{"update:visible":function(e){return t.$set(t.PriceForm,"dialogVisible",e)}},model:{value:t.PriceForm.dialogVisible,callback:function(e){t.$set(t.PriceForm,"dialogVisible",e)},expression:"PriceForm.dialogVisible"}},[i("el-form",{ref:"PriceForm",attrs:{rules:t.PriceForm.rules,model:t.PriceForm}},[i("el-form-item",{staticStyle:{width:"280px",margin:"auto","line-height":"1.6"}},[i("el-input",{attrs:{min:"0",type:"number",placeholder:"单价"},model:{value:t.PriceForm.val,callback:function(e){t.$set(t.PriceForm,"val",e)},expression:"PriceForm.val"}})],1),i("el-form-item",{staticStyle:{"margin-top":"30px"}},[i("div",{staticStyle:{width:"100%","margin-left":"auto","margin-right":"auto","text-align":"center"}},[i("el-button",{on:{click:function(e){return t.resetPrice("PriceForm")}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updatePrice("PriceForm")}}},[t._v("确定")])],1)])],1)],1),i("el-dialog",{attrs:{width:"30%",title:"生产计划审批管理备注修改",visible:t.innerVisibleOrder,"append-to-body":""},on:{"update:visible":function(e){t.innerVisibleOrder=e}}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.innerVisibleInput,callback:function(e){t.innerVisibleInput=e},expression:"innerVisibleInput"}}),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.innerVisibleOrder=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.clickPostils}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"材料明细",visible:t.dialogMaterial,width:"60%"},on:{"update:visible":function(e){t.dialogMaterial=e}}},[i("div",{staticClass:"detail_top1"},[i("div",[t._v("关联源生产单号："+t._s(t.ProductionPlanDetailList.planCode))]),i("div",[t._v("入库人姓名："+t._s(t.ProductionPlanDetailList.auditUser))]),i("div",[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),i("div",[t._v("类型："+t._s("102301"==t.materialSettype?"工厂采购":"102302"==t.materialSettype?"公司采购":"采购类型不存在"))])]),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.MaterialDetailsList,stripe:"","max-height":"400px"}},[i("el-table-column",{attrs:{property:"data",label:"标识",width:"50",align:"center"}}),i("el-table-column",{attrs:{property:"namecode",label:"材料名称",align:"center"}}),i("el-table-column",{attrs:{property:"specif",label:"规格",align:"center"}}),i("el-table-column",{attrs:{property:"price",label:"单价(元)",align:"center"}}),i("el-table-column",{attrs:{property:"unit",label:"单位",align:"center"}}),i("el-table-column",{attrs:{property:"num",label:"生产数量",align:"center"}}),i("el-table-column",{attrs:{property:"outcount",label:"出库数量",align:"center"}}),i("el-table-column",{attrs:{property:"specif",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{directives:[{name:"show",rawName:"v-show",value:102801===e.row.nodeType,expression:"scope.row.nodeType===102801"}]},[t._v("待处理")]),i("span",{directives:[{name:"show",rawName:"v-show",value:102802===e.row.nodeType,expression:"scope.row.nodeType===102802"}]},[t._v("已处理")]),i("span",{directives:[{name:"show",rawName:"v-show",value:102803===e.row.nodeType,expression:"scope.row.nodeType===102803"}]},[t._v("已出库")]),i("span",{directives:[{name:"show",rawName:"v-show",value:102804===e.row.nodeType,expression:"scope.row.nodeType===102804"}]},[t._v("已确认")])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){t.dialogMaterial=!1}}},[t._v("返 回")])],1)],1),i("el-dialog",{attrs:{title:"采购查看",visible:t.purchaseDialog.sync,width:"1000px"},on:{"update:visible":function(e){return t.$set(t.purchaseDialog,"sync",e)}}},[i("div",{staticClass:"detail_top1 detail_top2"},[i("div",{staticStyle:{width:"100%"}},[t._v("关联源生产单号："+t._s(t.ProductionPlanDetailList.planCode))]),i("div",{staticStyle:{width:"45%"}},[t._v("工厂名称："+t._s(t.ProductionPlanDetailList.factoryName))]),i("div",{staticStyle:{width:"45%"}},[t._v("采购类型："+t._s(t.purchaseDialog.row.typeName))])]),i("el-table",{key:t.purchaseDialog.row.settype,staticStyle:{width:"100%"},attrs:{data:t.purchaseDialog.Data,stripe:"","max-height":"400px"}},[i("el-table-column",{attrs:{property:"index",label:"序号",width:"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.$index+1)+" ")]}}])}),i("el-table-column",{attrs:{property:"namecode",label:"材料名称",align:"center"}}),i("el-table-column",{attrs:{property:"specification",label:"规格",align:"center"}}),i("el-table-column",{attrs:{property:"unit",label:"单位",align:"center"}}),[102302].indexOf(Number(t.purchaseDialog.row.settype))<0?i("el-table-column",{attrs:{property:"price",label:"参考单价",align:"center"}}):t._e(),i("el-table-column",{attrs:{property:"num",label:"数量",align:"center"}}),[102302].indexOf(Number(t.purchaseDialog.row.settype))<0?i("el-table-column",{attrs:{property:"amount",label:"参考金额",align:"center"}}):t._e(),i("el-table-column",{attrs:{property:"hxInventory",label:"华项仓库库存",align:"center"}}),i("el-table-column",{attrs:{property:"inventory",label:"工厂仓库库存",align:"center"}})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium"},on:{click:function(e){t.purchaseDialog.sync=!1}}},[t._v("关 闭")])],1)],1),i("el-dialog",{attrs:{width:"25%",title:"驳回",visible:t.rejectData.sync,"append-to-body":""},on:{"update:visible":function(e){return t.$set(t.rejectData,"sync",e)}}},[i("span",[t._v("你确定要对已选的数据进行驳回吗？")]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.rejectData.sync=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.rejectClick(1)}}},[t._v("确 定")])],1)]),i("MakeGoodsModify",{ref:"MakeGoodsModify",on:{ToUpDate:t.Detail_ToUpData}})],1)},n=[],o=i("1da1"),r=i("5530"),s=(i("96cf"),i("d3b7"),i("159b"),i("b0c0"),i("25f0"),i("d81d"),i("b64b"),i("ef7e")),l=i("062d"),c=i("7c58"),d=i("49e5"),u=i("2f62"),p=i("2f88"),m={components:{MakeGoodsModify:d["a"],AppPaging:p["a"]},data:function(){return{scrollTop:0,scrollLeft:0,standard:{num:0,price:0},outerVisible:!1,ProductionPlanDetailList:[],ProductionDetailsList:[],loadingVisible:!1,clickUnit_type:0,unitForm:{dialogVisible:!1,id:"",unit:"",rules:{script:[{required:!0,message:"请输入单位",trigger:"blur"}]},optdate:""},PriceForm:{dialogVisible:!1,row:{},id:"",val:"",max_val:"",rules:{script:[{required:!0,message:"请输入单价",trigger:"blur"}]},optdate:""},UnitsData:{list:[],editUnit:"",index:0,id:0,conversionRatio:"",parame:{detailId:0,unit:"",unitBit:0}},doubleAuditTime:"",doubleAuditTimes:"",rejectData:{param:{},sync:!1,val:""},dialogMaterial:!1,materialSettype:{},MaterialDetailsList:[],stateName:"",statyNum:"",dialogVisibleDate:!1,latestDataTime:"",stateInput:"",innerVisibleOrder:!1,innerVisibleId:"",innerVisibleInput:"",purchaseDialog:{sync:!1,row:{},Data:[]},table_id_arr_detail:[],table_plan_arr_detail:[],table_id_arr:[],table_plan_arr:[],statusList:[],FactoryNameList:[],formQuery:{startDate:"",endDate:"",nodetype:""},paramData:{page:1,pageSize:24},total:0,tableData:[],loadingTab:!1,dateValue:"",buttonPermissions:[],tableType:1,tableCheckedIds:[],index_name:"warehouse"}},computed:Object(r["a"])({},Object(u["c"])({roles:"roles",userId:"user/userId",name:"user/name"})),created:function(){this.buttonPermissions=this.roles[0].buttonPermissions,this.getformQueryStatusList(),this.getFactoryName(),this.onSubmit()},mounted:function(){},methods:{starDataMax:function(t){if(this.formQuery.endDate)return t.getTime()>=Date.parse(this.formQuery.endDate)},endDataMin:function(t){if(this.formQuery.startDate)return t.getTime()<=Date.parse(this.formQuery.startDate)-864e5},Detail_ToUpData:function(){this.getProductionPlanDetailList(this.parameterDetail)},GoodsModifyOpen2:function(t){this.$refs.MakeGoodsModify.init(t,this.ProductionPlanDetailList)},detailsSelectionChange:function(t){var e=this;this.table_id_arr_detail=[],this.table_plan_arr_detail=[],t.length>0&&(this.table_plan_arr_detail=t,t.forEach((function(t){e.table_id_arr_detail.push(t.id)})))},cancelProductionDetails:function(t,e){var i=this,a={operator:this.name,planId:this.idLists,remarks:""},n="你确定要取消选中的商品吗？";if(1===t&&(a.planDetailIds=[e]),3===t){if(this.table_id_arr_detail.length<=0)return void this.$message.warning("请您选择要操作的数据！");n="你确定要取消当前选中的"+this.table_id_arr_detail.length+"个商品吗？",a.planDetailIds=this.table_id_arr_detail}this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showInput:!0,inputPlaceholder:"请输入取消原因"}).then((function(t){a.remarks=t.value,Object(s["d"])(a).then((function(t){200===t.code&&(i.$message.success(t.message),a.planDetailIds.length>=i.ProductionDetailsList.length&&(i.outerVisible=!1),i.getProductionPlanDetailList(i.parameterDetail),i.setTable(i.paramData))}))})).catch((function(){}))},cancelProduction:function(t,e){var i=this,a={operator:this.name,remarks:""},n="你确定要取消当前的生产计划单吗？";if(1===t&&(a.planId=e),3===t){if(this.table_id_arr.length<=0)return void this.$message.warning("请您选择要操作的数据！");n="你确定要取消当前选中的"+this.table_id_arr.length+"条生产计划单吗？",a.planId=this.table_id_arr}this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showInput:!0,inputPlaceholder:"请输入取消原因"}).then((function(t){a.remarks=t.value,Object(s["c"])(a).then((function(t){200===t.code&&(i.$message.success(t.message),i.outerVisible=!1,i.setTable(i.paramData))}))})).catch((function(){}))},get_num_amount:function(){this.standard.num=this.count_price2(this.GoodsModifyDemo.data.num_modify,this.GoodsModifyDemo.data.unitbit),this.set_amount_modify()},get_num_price:function(t){this.standard.price=this.count_price(this.GoodsModifyDemo.data.price_modify,this.GoodsModifyDemo.data.unitbit),1!==t&&this.set_amount_modify()},set_amount_modify:function(){var t=this.GoodsModifyDemo.data.num_modify,e=this.GoodsModifyDemo.data.price_modify,i=Math.ceil(1e4*t*e)/1e4;this.GoodsModifyDemo.data.amount_modify=i},get_amount_modify:function(){var t=this.GoodsModifyDemo.data.amount_modify,e=this.GoodsModifyDemo.data.num_modify,i=Math.ceil(1e4*t/e)/1e4;this.GoodsModifyDemo.data.price_modify=i,this.get_num_price(1)},detailsUpdateUnit:function(){this.GoodsModifyDemo.data.unit_modify=this.UnitsData.parame.unit;var t=this.count_price2(this.standard.price,this.UnitsData.parame.unitBit);this.GoodsModifyDemo.data.price_modify=t;var e=this.count_price(this.standard.num,this.UnitsData.parame.unitBit);this.GoodsModifyDemo.data.num_modify=e,this.GoodsModifyDemo.data.unitbit_d=this.UnitsData.parame.unitBit,this.resetUnit()},getformQueryStatusList:function(){this.formQuery.nodetype=100600,this.statusList=[{id:100600,namecode:"未提交"},{id:100601,namecode:"正在初审"},{id:100611,namecode:"初审驳回"},{id:100602,namecode:"正在复审"},{id:100612,namecode:"复审驳回"},{id:100605,namecode:"入库中"},{id:100606,namecode:"完成入库"},{id:100607,namecode:"已作废"},{id:100608,namecode:"完成支付"}]},rejectClick:function(t){var e=this;if(0===t){if(!this.table_id_arr.length)return void this.$message({type:"warning",message:"请您选择要操作的数据！"});this.rejectData.sync=!0,this.rejectData.val="",this.rejectData.param={I_optType:11,I_ids:this.table_id_arr.toString(),I_rovaluser:this.name},100601===this.formQuery.nodetype?this.rejectData.param.I_optType=11:100602===this.formQuery.nodetype?this.rejectData.param.I_optType=12:this.$message.warning("相关状态功能还在开发中！")}1===t&&Object(s["o"])(this.rejectData.param).then((function(t){e.loadingWeb=!1,200===t.code?(e.$message.success("驳回成功!"),e.paramData.page=1,e.setTable(e.paramData),e.outerVisible=!1,e.rejectData.sync=!1):e.$message.warning(t.message)}))},rejectClick2:function(){this.table_id_arr=[],this.table_id_arr.push(this.idLists),this.rejectClick(0)},clickApproval:function(){if(this.table_id_arr.length){this.idList=this.table_id_arr.toString();var t={I_optType:1,I_ids:this.idList,I_rovaluser:this.name};if([100601,100612].indexOf(this.paramData.nodetype)>=0)t.I_optType=1;else if(100602===this.paramData.nodetype)t.I_optType=2;else{if(!([100600,100611].indexOf(this.paramData.nodetype)>=0))return void this.$message({type:"warning",message:"当前状态对应审核还在开发中！"});t.I_optType=0}this.getProductionPlanAudit(t)}else this.$message({type:"warning",message:"请您选择要操作的数据！"})},getProductionPlanAudit:function(t){var e=this;Object(s["o"])(t).then((function(t){e.loadingWeb=!1,200===t.code?(e.$message({type:"success",message:"成功审批!"}),e.paramData.page=1,e.setTable(e.paramData)):e.$message({message:t.message,type:"warning"})}))},clickUnit:function(t,e){this.clickUnit_type=e||0,this.unitForm.unit=t.unit;var i={productId:t.productId,unit:t.unit};3===e&&(i.unit=t.unit_modify),this.UnitsData.id=t.id,this.UnitsData.index=0,this.getUnitsToPlan(i)},getUnitsToPlan:function(t){var e=this;this.UnitsData.parame.detailId=this.UnitsData.id,Object(c["R"])(t).then((function(t){200===t.code?e.unit_dialog_init(t.data):e.$message({message:t.message,type:"warning"})}))},unit_dialog_init:function(t){if(t.length>0){this.UnitsData.list=t;var e=t[0];this.UnitsData.conversionRatio=e.conversionRatio,this.UnitsData.parame.unit=e.namecode,this.UnitsData.parame.unitBit=e.data,this.unitForm.dialogVisible=!0}else this.$message({message:"该商品暂无更多单位可选",type:"warning"})},updateUnit:function(){var t=this;3!==this.clickUnit_type?Object(s["D"])(this.UnitsData.parame).then((function(e){200===e.code&&(t.$message({message:"修改单位成功！",type:"success"}),t.getProductionPlanDetailList(t.parameterDetail),t.resetUnit())})):this.detailsUpdateUnit()},resetUnit:function(){this.unitForm.dialogVisible=!1},unitSelect:function(){var t=this.UnitsData.list[this.UnitsData.index];this.UnitsData.conversionRatio=t.conversionRatio,this.UnitsData.parame.unit=t.namecode,this.UnitsData.parame.unitBit=t.data},resetPrice:function(){this.PriceForm.dialogVisible=!1},updatePrice:function(){var t=this,e={amount:Math.ceil(100*this.PriceForm.val*this.PriceForm.row.num)/100,price:this.count_price(this.PriceForm.val,this.PriceForm.unitbit)};Object(s["b"])(e,this.PriceForm.id).then((function(e){200===e.code&&(t.$message({message:"修改单价成功！",type:"success"}),t.getProductionPlanDetailList(t.parameterDetail),t.resetPrice())}))},clickPrice:function(t){this.PriceForm.row=t,this.PriceForm.unitbit=t.unitbit,this.PriceForm.val=t.price,this.PriceForm.id=t.id,this.PriceForm.dialogVisible=!0},clickPostil:function(t){this.innerVisibleRow=t,this.innerVisibleInput=t.script,this.innerVisibleOrder=!0},clickPostils:function(){var t=this;if(""!==this.innerVisibleInput){var e={id:this.innerVisibleRow.id,postscript:{script:this.innerVisibleInput},remarks:"{script:"+this.innerVisibleInput+"}"};Object(s["z"])(e).then((function(e){200===e.code&&(t.$message.success(e.message),t.$emit("UpTable"),t.innerVisibleOrder=!1,t.getProductionPlanDetailList(t.parameterDetail))}))}else this.$message.warning("备注内容不能为空")},materialClick:function(t){var e=this;this.materialSettype=t.settype,this.dialogMaterial=!0;var i={productionPlanId:t.id,purchaseType:t.settype};Object(s["t"])(i).then((function(t){200===t.code?e.MaterialDetailsList=t.data:e.$message({type:"warning",message:t.message})}))},purchaseClick:function(t){var e=this;this.purchaseDialog.row=t,this.purchaseDialog.sync=!0,this.purchaseDialog.Data=[];var i={planDetailId:t.id};Object(s["m"])(i).then((function(t){200===t.code&&(e.purchaseDialog.Data=t.data)}))},clickDate:function(t,e){this.statyNum=e,this.dialogVisibleDate=!0,this.latestDataTime="",this.stateName=2===e?"备注":"最迟交货期",this.latestDataTimeId=t},clickDates:function(){var t=this,e=this.statyNum;if(2!==e){var i={targetId:this.latestDataTimeId.id,lastDeliveryDate:this.latestDataTime};Object(s["B"])(i).then((function(e){if(200===e.code){t.dialogVisibleDate=!1;for(var i=t.tableData,a=0;a<i.length;a++)i[a].id===t.latestDataTimeId&&(i[a].lastdate=t.latestDataTime);t.$message({type:"success",message:"成功设置最迟交货时间"}),("100600"===t.latestDataTimeId.nodetype||"100601"===t.latestDataTimeId.nodetype)&&t.setTable(t.paramData)}}))}else{var a=this.latestDataTimeId.vdata||{};a.postil=this.stateInput;var n={id:this.latestDataTimeId.id,remarks:this.stateInput,postscript:a};Object(s["y"])(n).then((function(e){200===e.code&&(t.dialogVisibleDate=!1,t.setTable(t.paramData),t.$message({type:"success",message:"成功添加备注"}),t.stateInput="")}))}},detailAudit:function(){var t=this;this.$confirm("是否确认审批","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={I_optType:1,I_ids:t.idLists,I_rovaluser:t.name};if(["100601","100612"].indexOf(t.ProductionPlanDetailList.nodetype)>=0)e.I_optType=1;else if("100602"===t.ProductionPlanDetailList.nodetype)e.I_optType=2;else{if(!(["100600","100611"].indexOf(t.ProductionPlanDetailList.nodetype)>=0))return void t.$message({type:"warning",message:"当前生产计划的审批功能还在开发中！"});e.I_optType=0}Object(s["o"])(e).then((function(e){200===e.code?(t.$message({type:"success",message:e.message}),t.setTable(t.paramData),t.outerVisible=!1):t.$message({type:"warning",message:e.message})}))})).catch((function(){t.$message({type:"info",message:"已取消审批"})}))},clickDetail:function(t){this.unitForm.optdate=t.optdate,this.doubleAuditTime=t.doubleAuditTime,this.doubleAuditTimes=t.auditTime,this.outerVisible=!0,this.idLists=t.id,this.Plannedtime="";var e={id:t.id};this.parameterDetail=e,this.getProductionPlanDetailList(e)},getProductionPlanDetailList:function(t){var e=this;this.loadingVisible=!0,Object(s["p"])(t).then((function(t){e.loadingVisible=!1,200===t.code&&(e.ProductionDetailsList=t.data.productionPlanDetailList.list.map((function(t){return t.remarks="",t.script="",t.vdata&&(t.vdata=JSON.parse(t.vdata),t.script=t.vdata.script||""),t})),e.ProductionPlanDetailList=t.data,e.ProductionPlanDetailList.vdata=JSON.parse(e.ProductionPlanDetailList.vdata),null===e.ProductionPlanDetailList.planTime&&(e.Plannedtime=e.unitForm.optdate))}))},goProductplan:function(){this.$router.push({path:"/operationmanagement/production/productplan",query:{path:!0}})},getFactoryName:function(){var t=this;Object(l["o"])({}).then((function(e){if(200===e.code){var i=[];e.data.forEach((function(t){1!==t.data&&i.push(t)})),t.FactoryNameList=i}}))},chengRegion2:function(t){this.formQuery.areaId=t},copyJSON:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=document.createElement("input"),a.value=t,document.body.appendChild(a),a.select(),i.prev=4,i.next=7,document.execCommand("Copy");case 7:e.$message({message:"已成功复制sku",type:"success"}),i.next=12;break;case 10:i.prev=10,i.t0=i["catch"](4);case 12:case"end":return i.stop()}}),i,null,[[4,10]])})))()},handleSelectionChange:function(t){var e=this;this.table_id_arr=[],this.table_plan_arr=[],t.length>0&&t.forEach((function(t){e.table_id_arr.push(t.id),t.isProduction&&e.table_plan_arr.push(t)}))},AddConsignor:function(){},handleSizeChange:function(t){this.paramData.pageSize=t,this.handleCurrentChange(1)},handleCurrentChange:function(t){this.paramData.page=t,this.setTable(this.paramData)},onSubmit:function(){var t=Object(r["a"])({page:1,pageSize:this.paramData.pageSize},this.formQuery);Object.keys(t).forEach((function(e){var i=t[e];""===i&&delete t[e]})),this.paramData=t,this.setTable(this.paramData)},setTable:function(t){var e=this;this.loadingTab=!0,Object(s["r"])(t).then((function(t){if(e.loadingTab=!1,200===t.code){var i=t.data.list;i.forEach((function(t){t.cancelReason="",t.vdata&&(t.cancelReason=t.vdata.cancelReason||"")})),e.tableData=i,e.total=t.data.total,e.table_id_arr=[]}}))}},activated:function(){var t=this;setTimeout((function(){t.$refs.TableData.bodyWrapper.scrollTop=t.scrollTop,t.$refs.TableData.bodyWrapper.scrollLeft=t.scrollLeft}),60)},beforeRouteLeave:function(t,e,i){this.scrollTop=this.$refs.TableData.bodyWrapper.scrollTop,this.scrollLeft=this.$refs.TableData.bodyWrapper.scrollLeft,i()}},f=m,h=(i("9138"),i("2877")),b=Object(h["a"])(f,a,n,!1,null,"4db6d5e3",null);e["default"]=b.exports},f7f2:function(t,e,i){}}]);